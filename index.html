<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Montage Builder Pro - Channel Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        }

        body {
            background: #0f0f23;
            color: #ffffff;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #4CAF50;
            text-align: center;
            margin: 0;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            padding: 0;
            margin: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            border: none;
            background: transparent;
            color: #ffffff;
            opacity: 0.7;
            position: relative;
        }

        .tab:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            opacity: 1;
            background: rgba(76, 175, 80, 0.1);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #4CAF50;
        }

        .tab-content {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h3 {
            margin-bottom: 15px;
            color: #4CAF50;
            font-size: 16px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #cccccc;
        }

        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .form-row label {
            margin-bottom: 0;
            min-width: 120px;
            font-size: 13px;
        }

        input[type="text"], 
        input[type="number"], 
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 13px;
        }

        select {
            cursor: pointer;
        }

        select option {
            background: #1a1a2e;
            color: #ffffff;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        select:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(255, 255, 255, 0.15);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #81C784);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: 500;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .info-panel {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-text {
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-line;
        }

        /* –ö–∞–Ω–∞–ª—ã */
        .channel-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .channel-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .channel-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(76, 175, 80, 0.5);
        }

        .channel-card.selected {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }

        .channel-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .channel-info {
            font-size: 11px;
            color: #999;
        }

        .channel-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .channel-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .channel-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* –ß–µ–∫–±–æ–∫—Å—ã –∏ —Ä–∞–¥–∏–æ */
        .checkbox-group,
        .radio-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        /* –°–ª–∞–π–¥–µ—Ä—ã */
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .slider-group label {
            min-width: 120px;
            margin-bottom: 0;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider-value {
            min-width: 50px;
            text-align: center;
            font-size: 12px;
            color: #4CAF50;
            font-weight: 500;
        }

        /* –õ–æ–≥–∏ */
        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            height: 150px;
            overflow-y: auto;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 11px;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 2px;
            padding: 2px 0;
        }

        .log-info { color: #4CAF50; }
        .log-warning { color: #ff9800; }
        .log-error { color: #f44336; }

        /* –°–ø–∏—Å–æ–∫ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ */
        .effects-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .effect-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #4CAF50;
            font-size: 20px;
            margin: 0;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(76, 175, 80, 0.6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 175, 80, 0.8);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .error {
            animation: shake 0.5s;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 33.333%;
            }
            
            .form-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-row label {
                min-width: auto;
                margin-bottom: 5px;
            }
        }

        /* –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã */
        .cancel-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .cancel-button.show {
            display: flex;
        }

        .cancel-button:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        /* –¢–µ–≥–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            border-radius: 16px;
            font-size: 11px;
            margin: 2px;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ AUTO MONTAGE BUILDER PRO - CHANNEL EDITION</h1>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="generation">üé¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
            <button class="tab" data-tab="channels">üì∫ –ö–∞–Ω–∞–ª—ã</button>
            <button class="tab" data-tab="effects">üé® –≠—Ñ—Ñ–µ–∫—Ç—ã</button>
            <button class="tab" data-tab="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <div class="tab-content active" id="generation">
            <div class="panel">
                <h3>üìÅ –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="form-row">
                    <input type="text" id="projectPath" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –∞—É–¥–∏–æ" readonly>
                    <button class="btn btn-secondary" onclick="selectProjectFolder()">–û–±–∑–æ—Ä...</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-text" id="projectInfo">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</div>
            </div>

            <div class="panel">
                <h3>üì∫ –í—ã–±–æ—Ä –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3>
                <div class="channel-list" id="generationChannelList">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è -->
                </div>
                <div class="info-text" style="margin-top: 10px; font-size: 12px; color: #999;">
                    –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ. –ö–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª —Å–æ–∑–¥–∞—Å—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.
                </div>
            </div>

            <div class="panel">
                <h3>üì§ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
                <div class="form-row">
                    <label>–†–µ–∂–∏–º —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                    <select id="exportMode">
                        <option value="timeline">–û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω–µ</option>
                        <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ Media Encoder</option>
                        <option value="manual">–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å Media Encoder</option>
                    </select>
                </div>
                <div class="form-row">
                    <label>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤:</label>
                    <select id="outputFormat">
                        <option value="h264">H.264 (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)</option>
                        <option value="h265">H.265/HEVC (–º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä)</option>
                        <option value="prores">ProRes (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)</option>
                    </select>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="importFiles()">üìÇ –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤</button>
                <button class="btn btn-primary" onclick="generateMontage()" id="generateBtn">
                    üé¨ –°–û–ó–î–ê–¢–¨ –ú–û–ù–¢–ê–ñ
                </button>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-text" id="progressText">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
                </div>
            </div>

            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö–∞–Ω–∞–ª—ã -->
        <div class="tab-content" id="channels">
            <div class="panel">
                <h3>üì∫ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏</h3>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="createChannel()">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª</button>
                    <button class="btn btn-secondary" onclick="importChannels()">üì• –ò–º–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" onclick="exportChannels()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                </div>
            </div>

            <div class="panel">
                <h3>üìã –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤</h3>
                <div class="channel-list" id="channelList">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è -->
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –≠—Ñ—Ñ–µ–∫—Ç—ã -->
        <div class="tab-content" id="effects">
            <div class="info-panel">
                <div class="info-text">
                    –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –µ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                </div>
            </div>

            <div class="panel">
                <h3>üì∫ –¢–µ–∫—É—â–∏–π –∫–∞–Ω–∞–ª: <span id="currentChannelName">–ù–µ –≤—ã–±—Ä–∞–Ω</span></h3>
                <select id="channelSelector" onchange="loadChannelEffects()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>
                </select>
            </div>

            <div id="effectsEditor" style="display: none;">
                <!-- Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã -->
                <div class="panel">
                    <h3>üé¨ Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                    <div class="effects-list">
                        <div class="effect-item">
                            <input type="checkbox" id="kb_zoomIn" class="kb-effect">
                            <label for="kb_zoomIn">Zoom In (–ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="kb_zoomOut" class="kb-effect">
                            <label for="kb_zoomOut">Zoom Out (–æ—Ç–¥–∞–ª–µ–Ω–∏–µ)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="kb_panLeft" class="kb-effect">
                            <label for="kb_panLeft">Pan Left (–¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="kb_panRight" class="kb-effect">
                            <label for="kb_panRight">Pan Right (–¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="kb_panUp" class="kb-effect">
                            <label for="kb_panUp">Pan Up (–¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="kb_panDown" class="kb-effect">
                            <label for="kb_panDown">Pan Down (–¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="kb_rotate" class="kb-effect">
                            <label for="kb_rotate">Rotate (–≤—Ä–∞—â–µ–Ω–∏–µ)</label>
                        </div>
                    </div>
                    
                    <div class="slider-group">
                        <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                        <input type="range" id="kbIntensity" class="slider" min="0" max="100" value="30">
                        <span class="slider-value" id="kbIntensityValue">30%</span>
                    </div>
                    
                    <div class="slider-group">
                        <label>–£–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è:</label>
                        <input type="range" id="rotationAngle" class="slider" min="0" max="30" value="5">
                        <span class="slider-value" id="rotationAngleValue">5¬∞</span>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="kbSmartCrop" checked>
                        <label for="kbSmartCrop">–£–º–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Å)</label>
                    </div>
                </div>

                <!-- –ê–Ω–∏–º–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∞ -->
                <div class="panel">
                    <h3>üîç –ê–Ω–∏–º–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∞</h3>
                    <div class="effects-list">
                        <div class="effect-item">
                            <input type="checkbox" id="scale_pulse" class="scale-effect">
                            <label for="scale_pulse">Pulse (–ø—É–ª—å—Å–∞—Ü–∏—è)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="scale_bounce" class="scale-effect">
                            <label for="scale_bounce">Bounce (–ø—Ä—ã–∂–æ–∫)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="scale_elastic" class="scale-effect">
                            <label for="scale_elastic">Elastic (—ç–ª–∞—Å—Ç–∏—á–Ω—ã–π)</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="scale_smooth" class="scale-effect">
                            <label for="scale_smooth">Smooth (–ø–ª–∞–≤–Ω—ã–π)</label>
                        </div>
                    </div>
                    
                    <div class="slider-group">
                        <label>–ê–º–ø–ª–∏—Ç—É–¥–∞:</label>
                        <input type="range" id="scaleAmplitude" class="slider" min="0" max="50" value="10">
                        <span class="slider-value" id="scaleAmplitudeValue">10%</span>
                    </div>
                </div>

                <!-- –ü–µ—Ä–µ—Ö–æ–¥—ã -->
                <div class="panel">
                    <h3>üîÑ –ü–µ—Ä–µ—Ö–æ–¥—ã</h3>
                    <div class="effects-list">
                        <div class="effect-item">
                            <input type="checkbox" id="trans_fade" class="transition-effect">
                            <label for="trans_fade">Fade</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_dissolve" class="transition-effect">
                            <label for="trans_dissolve">Cross Dissolve</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_dip_black" class="transition-effect">
                            <label for="trans_dip_black">Dip to Black</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_dip_white" class="transition-effect">
                            <label for="trans_dip_white">Dip to White</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_wipe" class="transition-effect">
                            <label for="trans_wipe">Wipe</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_slide" class="transition-effect">
                            <label for="trans_slide">Slide</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_push" class="transition-effect">
                            <label for="trans_push">Push</label>
                        </div>
                        <div class="effect-item">
                            <input type="checkbox" id="trans_zoom" class="transition-effect">
                            <label for="trans_zoom">Zoom</label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</label>
                        <input type="number" id="transitionDuration" value="1.0" min="0.1" max="3.0" step="0.1" style="width: 100px;">
                        <span>—Å–µ–∫—É–Ω–¥</span>
                    </div>
                </div>

                <!-- –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è -->
                <div class="panel">
                    <h3>üé® –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä—ã</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableColorCorrection">
                        <label for="enableColorCorrection">–í–∫–ª—é—á–∏—Ç—å —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é</label>
                    </div>
                    
                    <div id="colorCorrectionSettings" style="display: none;">
                        <div class="form-row">
                            <label>–§–∏–ª—å—Ç—Ä:</label>
                            <select id="colorFilter">
                                <option value="none">–ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞</option>
                                <option value="warm">–¢–µ–ø–ª—ã–π</option>
                                <option value="cold">–•–æ–ª–æ–¥–Ω—ã–π</option>
                                <option value="vintage">–í–∏–Ω—Ç–∞–∂</option>
                                <option value="blackwhite">–ß–µ—Ä–Ω–æ-–±–µ–ª—ã–π</option>
                                <option value="sepia">–°–µ–ø–∏—è</option>
                                <option value="cinematic">–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π</option>
                            </select>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="enableVignette">
                            <label for="enableVignette">–í–∏–Ω—å–µ—Ç–∫–∞</label>
                        </div>
                        
                        <div class="slider-group" id="vignetteSettings" style="display: none;">
                            <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                            <input type="range" id="vignetteIntensity" class="slider" min="0" max="100" value="40">
                            <span class="slider-value" id="vignetteIntensityValue">40%</span>
                        </div>
                    </div>
                </div>

                <!-- –ê—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                <div class="panel">
                    <h3>üéµ –ê—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                    <div class="form-row">
                        <label>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (Pitch):</label>
                        <select id="audioPitch">
                            <option value="-3">-3 (–æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π)</option>
                            <option value="-2">-2 (–Ω–∏–∑–∫–∏–π)</option>
                            <option value="-1.5">-1.5</option>
                            <option value="-1">-1</option>
                            <option value="-0.5">-0.5</option>
                            <option value="0" selected>0 (–æ—Ä–∏–≥–∏–Ω–∞–ª)</option>
                            <option value="+0.5">+0.5</option>
                            <option value="+1">+1</option>
                            <option value="+1.5">+1.5</option>
                            <option value="+2">+2 (–≤—ã—Å–æ–∫–∏–π)</option>
                            <option value="+3">+3 (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π)</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <label>–≠—Ñ—Ñ–µ–∫—Ç:</label>
                        <select id="audioEffect">
                            <option value="none">–ë–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞</option>
                            <option value="bass">–£—Å–∏–ª–µ–Ω–∏–µ –±–∞—Å–æ–≤</option>
                            <option value="reverb">–†–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—è</option>
                            <option value="echo">–≠—Ö–æ</option>
                            <option value="chorus">–•–æ—Ä—É—Å</option>
                            <option value="telephone">–¢–µ–ª–µ—Ñ–æ–Ω</option>
                            <option value="underwater">–ü–æ–¥ –≤–æ–¥–æ–π</option>
                        </select>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="audioStereoEnhance">
                        <label for="audioStereoEnhance">–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—Ç–µ—Ä–µ–æ</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="audioNormalize" checked>
                        <label for="audioNormalize">–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏</label>
                    </div>
                </div>

                <!-- –ü–ª–∞–≤–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ -->
                <div class="panel">
                    <h3>‚ö° –ü–ª–∞–≤–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</h3>
                    <div class="form-row">
                        <label>–¢–∏–ø –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏:</label>
                        <select id="easingType">
                            <option value="linear">–õ–∏–Ω–µ–π–Ω–∞—è</option>
                            <option value="ease" selected>–ü–ª–∞–≤–Ω–∞—è</option>
                            <option value="ease-in">–£—Å–∫–æ—Ä–µ–Ω–∏–µ</option>
                            <option value="ease-out">–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ</option>
                            <option value="ease-in-out">–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ</option>
                            <option value="bezier">–ö—Ä–∏–≤–∞—è –ë–µ–∑—å–µ</option>
                        </select>
                    </div>
                    
                    <div id="bezierSettings" style="display: none;">
                        <div class="slider-group">
                            <label>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 1:</label>
                            <input type="range" id="bezierP1" class="slider" min="0" max="100" value="25">
                            <span class="slider-value" id="bezierP1Value">25</span>
                        </div>
                        <div class="slider-group">
                            <label>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 2:</label>
                            <input type="range" id="bezierP2" class="slider" min="0" max="100" value="75">
                            <span class="slider-value" id="bezierP2Value">75</span>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveChannelEffects()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
                    <button class="btn btn-secondary" onclick="resetChannelEffects()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="previewEffects()">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="tab-content" id="settings">
            <div class="panel">
                <h3>üìÅ –ü—É—Ç–∏ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º</h3>
                <div class="form-group">
                    <label>FFmpeg:</label>
                    <div class="form-row">
                        <input type="text" id="ffmpegPath" value="ffmpeg.exe">
                        <button class="btn btn-secondary" onclick="browsePath('ffmpeg')">...</button>
                    </div>
                    <div class="info-text" style="font-size: 11px; color: #999; margin-top: 5px;">
                        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ. –°–∫–∞—á–∞—Ç—å: https://ffmpeg.org/download.html
                    </div>
                </div>
                <div class="form-group">
                    <label>Media Encoder:</label>
                    <div class="form-row">
                        <input type="text" id="amePath" value="">
                        <button class="btn btn-secondary" onclick="browsePath('ame')">...</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                <div class="slider-group">
                    <label>–ü–æ—Ç–æ–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:</label>
                    <input type="range" id="renderThreads" class="slider" min="1" max="16" value="4">
                    <span class="slider-value" id="renderThreadsValue">4</span>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="useGPU" checked>
                    <label for="useGPU">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="useProxies">
                    <label for="useProxies">–°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –¥–ª—è 4K –≤–∏–¥–µ–æ</label>
                </div>
            </div>

            <div class="panel">
                <h3>üåê –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Ç–µ–π</h3>
                <div class="checkbox-group">
                    <input type="checkbox" id="transcodeRussian" checked>
                    <label for="transcodeRussian">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤</label>
                </div>
                <div class="info-text" style="font-size: 11px; color: #999; margin-top: 10px;">
                    FFmpeg –º–æ–∂–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä—É—Å—Å–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –≤ –ø—É—Ç—è—Ö. 
                    –≠—Ç–∞ –æ–ø—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏.
                </div>
            </div>

            <div class="panel">
                <h3>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</h3>
                <div class="checkbox-group">
                    <input type="checkbox" id="autoSave" checked>
                    <label for="autoSave">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="keepSourceAudio" checked>
                    <label for="keepSourceAudio">–°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã</label>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button class="btn btn-secondary" onclick="resetSettings()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>

            <div class="panel" style="margin-top: 30px;">
                <h3>‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</h3>
                <div class="info-text">
                    <strong>Auto Montage Builder Pro - Channel Edition</strong><br>
                    –í–µ—Ä—Å–∏—è: 3.0.0<br>
                    –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Adobe Premiere Pro 2020+<br><br>
                    
                    <strong>–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</strong><br>
                    ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è YouTube<br>
                    ‚Ä¢ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —á–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Å<br>
                    ‚Ä¢ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∞<br>
                    ‚Ä¢ –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤<br>
                    ‚Ä¢ –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä—É—Å—Å–∫–∏—Ö –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤<br>
                    ‚Ä¢ –ö—Ä–∏–≤—ã–µ –ë–µ–∑—å–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞ -->
    <div class="modal" id="channelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞:</label>
                    <input type="text" id="newChannelName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <input type="text" id="newChannelDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞">
                </div>
                <div class="form-group">
                    <label>–®–∞–±–ª–æ–Ω —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                    <select id="newChannelTemplate">
                        <option value="YouTube">YouTube (1920x1080)</option>
                        <option value="YouTube Shorts">YouTube Shorts (1080x1920)</option>
                        <option value="TikTok">TikTok (1080x1920)</option>
                        <option value="Instagram Reels">Instagram Reels (1080x1920)</option>
                        <option value="Instagram Feed">Instagram Feed (1080x1080)</option>
                        <option value="Twitter">Twitter (1280x720)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('channelModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewChannel()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã -->
    <button class="cancel-button" id="cancelButton" onclick="cancelGeneration()">‚úï</button>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let PROJECT_FOLDER = null;
        let AUDIO_VARIANTS_FOLDER = null;
        let RENDERS_FOLDER = null;
        let channels = [];
        let selectedChannels = new Set();
        let currentChannelId = null;
        let isGenerating = false;
        let generationAborted = false;

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const EXPORT_PRESETS = {
            'YouTube': { width: 1920, height: 1080, bitrate: 8000, fps: 30 },
            'YouTube Shorts': { width: 1080, height: 1920, bitrate: 10000, fps: 30 },
            'TikTok': { width: 1080, height: 1920, bitrate: 6000, fps: 30 },
            'Instagram Reels': { width: 1080, height: 1920, bitrate: 8000, fps: 30 },
            'Instagram Feed': { width: 1080, height: 1080, bitrate: 6000, fps: 30 },
            'Twitter': { width: 1280, height: 720, bitrate: 5000, fps: 30 }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            loadChannels();
            loadSettings();
            setupEventListeners();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º CEP –æ–∫—Ä—É–∂–µ–Ω–∏–µ
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                log('CEP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'info');
            } else {
                log('–†–∞–±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'warning');
            }
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –°–ª–∞–π–¥–µ—Ä—ã
            document.querySelectorAll('.slider').forEach(slider => {
                slider.addEventListener('input', function() {
                    const valueSpan = document.getElementById(this.id + 'Value');
                    if (valueSpan) {
                        let value = this.value;
                        if (this.id.includes('Angle')) {
                            value += '¬∞';
                        } else if (this.id !== 'renderThreads' && this.id !== 'bezierP1' && this.id !== 'bezierP2') {
                            value += '%';
                        }
                        valueSpan.textContent = value;
                    }
                });
            });

            // –ß–µ–∫–±–æ–∫—Å—ã
            document.getElementById('enableColorCorrection').addEventListener('change', function() {
                document.getElementById('colorCorrectionSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            document.getElementById('enableVignette').addEventListener('change', function() {
                document.getElementById('vignetteSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            document.getElementById('easingType').addEventListener('change', function() {
                document.getElementById('bezierSettings').style.display = 
                    this.value === 'bezier' ? 'block' : 'none';
            });
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }

        // === –†–ê–ë–û–¢–ê –° –ü–ê–ü–ö–û–ô –ü–†–û–ï–ö–¢–ê ===
        
        function selectProjectFolder() {
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                
                const extScript = `
                    var folder = Folder.selectDialog("–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –∞—É–¥–∏–æ");
                    if (folder) {
                        folder.fsName;
                    } else {
                        null;
                    }
                `;
                
                csInterface.evalScript(extScript, function(result) {
                    if (result && result !== 'null') {
                        PROJECT_FOLDER = result;
                        document.getElementById('projectPath').value = result;
                        
                        AUDIO_VARIANTS_FOLDER = PROJECT_FOLDER + "/audio_variants";
                        RENDERS_FOLDER = PROJECT_FOLDER + "/renders";
                        
                        createSubfolders();
                        scanProjectFolder();
                    }
                });
            } else {
                // –†–µ–∂–∏–º —Å–∏–º—É–ª—è—Ü–∏–∏
                PROJECT_FOLDER = "C:/TestProject";
                document.getElementById('projectPath').value = PROJECT_FOLDER;
                AUDIO_VARIANTS_FOLDER = PROJECT_FOLDER + "/audio_variants";
                RENDERS_FOLDER = PROJECT_FOLDER + "/renders";
                
                updateProjectInfo({
                    images: 5,
                    audio: 5,
                    pairs: 5
                });
            }
        }

        function createSubfolders() {
            if (!PROJECT_FOLDER) return;
            
            const extScript = `
                var audioVariantsDir = new Folder("${AUDIO_VARIANTS_FOLDER.replace(/\\/g, '\\\\')}");
                if (!audioVariantsDir.exists) audioVariantsDir.create();
                
                var rendersDir = new Folder("${RENDERS_FOLDER.replace(/\\/g, '\\\\')}");
                if (!rendersDir.exists) rendersDir.create();
                
                "–ü–æ–¥–ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã";
            `;
            
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    log('–ü–æ–¥–ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω—ã', 'info');
                });
            }
        }

        function scanProjectFolder() {
            if (!PROJECT_FOLDER) return;
            
            updateProgress(10, "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏...");
            
            const extScript = `
                function scanFolder(folderPath) {
                    try {
                        var folder = new Folder(folderPath);
                        if (!folder.exists) {
                            return {images: 0, audio: 0, pairs: 0, error: "–ü–∞–ø–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"};
                        }
                        
                        var images = 0;
                        var audio = 0;
                        var pairs = [];
                        var imageFiles = {};
                        var audioFiles = {};
                        
                        var files = folder.getFiles();
                        var supportedImageFormats = ['.jpg', '.jpeg', '.png', '.tiff', '.bmp', '.tif'];
                        var supportedAudioFormats = ['.mp3', '.wav', '.aiff', '.m4a', '.flac'];
                        
                        // –°–∫–∞–Ω–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã
                        for (var i = 0; i < files.length; i++) {
                            if (files[i] instanceof File) {
                                var fileName = files[i].name;
                                var ext = fileName.substr(fileName.lastIndexOf('.')).toLowerCase();
                                var baseNumber = fileName.match(/^(\\d{4})/);
                                
                                if (supportedImageFormats.indexOf(ext) > -1) {
                                    images++;
                                    if (baseNumber) imageFiles[baseNumber[1]] = true;
                                } else if (supportedAudioFormats.indexOf(ext) > -1) {
                                    audio++;
                                    if (baseNumber) audioFiles[baseNumber[1]] = true;
                                }
                            }
                        }
                        
                        // –°—á–∏—Ç–∞–µ–º –ø–∞—Ä—ã
                        for (var num in imageFiles) {
                            if (audioFiles[num]) {
                                pairs.push(num);
                            }
                        }
                        
                        return {
                            images: images,
                            audio: audio,
                            pairs: pairs.length
                        };
                        
                    } catch(e) {
                        return {images: 0, audio: 0, pairs: 0, error: e.toString()};
                    }
                }
                
                JSON.stringify(scanFolder("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}"));
            `;
            
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    try {
                        const scanResult = JSON.parse(result);
                        updateProgress(0, "–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
                        updateProjectInfo(scanResult);
                    } catch(e) {
                        log('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + e.message, 'error');
                    }
                });
            }
        }

        function updateProjectInfo(scanResult) {
            let info = "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:\n\n";
            info += `‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${scanResult.images}\n`;
            info += `‚úÖ –ê—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤: ${scanResult.audio}\n`;
            info += `‚úÖ –ì–æ—Ç–æ–≤—ã—Ö –ø–∞—Ä: ${scanResult.pairs}`;
            
            if (scanResult.error) {
                info += `\n\n‚ö†Ô∏è –û—à–∏–±–∫–∞: ${scanResult.error}`;
            }
            
            document.getElementById('projectInfo').textContent = info;
            log(`–ù–∞–π–¥–µ–Ω–æ –ø–∞—Ä —Ñ–∞–π–ª–æ–≤: ${scanResult.pairs}`, 'info');
        }

        // === –†–ê–ë–û–¢–ê –° –ö–ê–ù–ê–õ–ê–ú–ò ===

        function loadChannels() {
            const stored = localStorage.getItem('autoMontageChannels');
            if (stored) {
                try {
                    channels = JSON.parse(stored);
                } catch(e) {
                    channels = getDefaultChannels();
                }
            } else {
                channels = getDefaultChannels();
            }
            
            updateChannelLists();
        }

        function getDefaultChannels() {
            return [
                {
                    id: 'channel_1',
                    name: '–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª',
                    description: '–ú–æ–π –≥–ª–∞–≤–Ω—ã–π YouTube –∫–∞–Ω–∞–ª',
                    template: 'YouTube',
                    effects: {
                        kenBurns: ['zoomIn', 'panRight'],
                        kenBurnsIntensity: 30,
                        rotationAngle: 5,
                        smartCrop: true,
                        scaleEffects: ['smooth'],
                        scaleAmplitude: 10,
                        transitions: ['fade', 'dissolve'],
                        transitionDuration: 1.0,
                        colorCorrection: true,
                        colorFilter: 'warm',
                        vignette: true,
                        vignetteIntensity: 40,
                        audioPitch: '-0.5',
                        audioEffect: 'bass',
                        audioStereoEnhance: true,
                        audioNormalize: true,
                        easingType: 'ease',
                        bezierP1: 25,
                        bezierP2: 75
                    }
                },
                {
                    id: 'channel_2',
                    name: 'Shorts –∫–∞–Ω–∞–ª',
                    description: '–ö–∞–Ω–∞–ª –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ',
                    template: 'YouTube Shorts',
                    effects: {
                        kenBurns: ['zoomOut', 'panUp'],
                        kenBurnsIntensity: 50,
                        rotationAngle: 10,
                        smartCrop: true,
                        scaleEffects: ['bounce'],
                        scaleAmplitude: 15,
                        transitions: ['zoom', 'slide'],
                        transitionDuration: 0.5,
                        colorCorrection: true,
                        colorFilter: 'cinematic',
                        vignette: false,
                        vignetteIntensity: 0,
                        audioPitch: '+1',
                        audioEffect: 'reverb',
                        audioStereoEnhance: false,
                        audioNormalize: true,
                        easingType: 'ease-in-out',
                        bezierP1: 25,
                        bezierP2: 75
                    }
                }
            ];
        }

        function saveChannels() {
            localStorage.setItem('autoMontageChannels', JSON.stringify(channels));
        }

        function updateChannelLists() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';
            
            channels.forEach(channel => {
                const card = document.createElement('div');
                card.className = 'channel-card';
                card.innerHTML = `
                    <div class="channel-name">${channel.name}</div>
                    <div class="channel-info">${channel.description}</div>
                    <div class="channel-info">–®–∞–±–ª–æ–Ω: ${channel.template}</div>
                    <div class="channel-actions">
                        <button class="channel-action-btn" onclick="editChannel('${channel.id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                        <button class="channel-action-btn" onclick="duplicateChannel('${channel.id}')" title="–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                        <button class="channel-action-btn" onclick="deleteChannel('${channel.id}')" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                `;
                channelList.appendChild(card);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            const genChannelList = document.getElementById('generationChannelList');
            genChannelList.innerHTML = '';
            
            channels.forEach(channel => {
                const card = document.createElement('div');
                card.className = 'channel-card';
                card.onclick = () => toggleChannelSelection(channel.id);
                card.innerHTML = `
                    <div class="channel-name">${channel.name}</div>
                    <div class="channel-info">${channel.template}</div>
                `;
                if (selectedChannels.has(channel.id)) {
                    card.classList.add('selected');
                }
                genChannelList.appendChild(card);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–∞–Ω–∞–ª–æ–≤ –≤ —ç—Ñ—Ñ–µ–∫—Ç–∞—Ö
            const channelSelector = document.getElementById('channelSelector');
            channelSelector.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>';
            
            channels.forEach(channel => {
                const option = document.createElement('option');
                option.value = channel.id;
                option.textContent = channel.name;
                channelSelector.appendChild(option);
            });
        }

        function toggleChannelSelection(channelId) {
            if (selectedChannels.has(channelId)) {
                selectedChannels.delete(channelId);
            } else {
                selectedChannels.add(channelId);
            }
            updateChannelLists();
        }

        function createChannel() {
            document.getElementById('channelModal').classList.add('show');
        }

        function saveNewChannel() {
            const name = document.getElementById('newChannelName').value.trim();
            const description = document.getElementById('newChannelDescription').value.trim();
            const template = document.getElementById('newChannelTemplate').value;
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞!');
                return;
            }
            
            const newChannel = {
                id: 'channel_' + Date.now(),
                name: name,
                description: description,
                template: template,
                effects: {
                    kenBurns: [],
                    kenBurnsIntensity: 30,
                    rotationAngle: 5,
                    smartCrop: true,
                    scaleEffects: [],
                    scaleAmplitude: 10,
                    transitions: ['fade'],
                    transitionDuration: 1.0,
                    colorCorrection: false,
                    colorFilter: 'none',
                    vignette: false,
                    vignetteIntensity: 40,
                    audioPitch: '0',
                    audioEffect: 'none',
                    audioStereoEnhance: false,
                    audioNormalize: true,
                    easingType: 'ease',
                    bezierP1: 25,
                    bezierP2: 75
                }
            };
            
            channels.push(newChannel);
            saveChannels();
            updateChannelLists();
            closeModal('channelModal');
            log(`–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª: ${name}`, 'info');
        }

        function editChannel(channelId) {
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            document.querySelector('[data-tab="effects"]').click();
            
            // –í—ã–±–∏—Ä–∞–µ–º –∫–∞–Ω–∞–ª
            document.getElementById('channelSelector').value = channelId;
            loadChannelEffects();
        }

        function duplicateChannel(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            const newChannel = JSON.parse(JSON.stringify(channel));
            newChannel.id = 'channel_' + Date.now();
            newChannel.name = channel.name + ' (–∫–æ–ø–∏—è)';
            
            channels.push(newChannel);
            saveChannels();
            updateChannelLists();
            log(`–ö–∞–Ω–∞–ª "${channel.name}" –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω`, 'info');
        }

        function deleteChannel(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª "${channel.name}"?`)) {
                channels = channels.filter(c => c.id !== channelId);
                saveChannels();
                updateChannelLists();
                log(`–ö–∞–Ω–∞–ª "${channel.name}" —É–¥–∞–ª–µ–Ω`, 'info');
            }
        }

        // === –†–ê–ë–û–¢–ê –° –≠–§–§–ï–ö–¢–ê–ú–ò ===

        function loadChannelEffects() {
            const channelId = document.getElementById('channelSelector').value;
            if (!channelId) {
                document.getElementById('effectsEditor').style.display = 'none';
                return;
            }
            
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            currentChannelId = channelId;
            document.getElementById('currentChannelName').textContent = channel.name;
            document.getElementById('effectsEditor').style.display = 'block';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const effects = channel.effects;
            
            // Ken Burns
            document.querySelectorAll('.kb-effect').forEach(cb => {
                const effectName = cb.id.replace('kb_', '');
                cb.checked = effects.kenBurns && effects.kenBurns.includes(effectName);
            });
            document.getElementById('kbIntensity').value = effects.kenBurnsIntensity || 30;
            document.getElementById('kbIntensityValue').textContent = (effects.kenBurnsIntensity || 30) + '%';
            document.getElementById('rotationAngle').value = effects.rotationAngle || 5;
            document.getElementById('rotationAngleValue').textContent = (effects.rotationAngle || 5) + '¬∞';
            document.getElementById('kbSmartCrop').checked = effects.smartCrop !== false;
            
            // Scale —ç—Ñ—Ñ–µ–∫—Ç—ã
            document.querySelectorAll('.scale-effect').forEach(cb => {
                const effectName = cb.id.replace('scale_', '');
                cb.checked = effects.scaleEffects && effects.scaleEffects.includes(effectName);
            });
            document.getElementById('scaleAmplitude').value = effects.scaleAmplitude || 10;
            document.getElementById('scaleAmplitudeValue').textContent = (effects.scaleAmplitude || 10) + '%';
            
            // –ü–µ—Ä–µ—Ö–æ–¥—ã
            document.querySelectorAll('.transition-effect').forEach(cb => {
                const effectName = cb.id.replace('trans_', '');
                cb.checked = effects.transitions && effects.transitions.includes(effectName);
            });
            document.getElementById('transitionDuration').value = effects.transitionDuration || 1.0;
            
            // –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
            document.getElementById('enableColorCorrection').checked = effects.colorCorrection || false;
            document.getElementById('colorCorrectionSettings').style.display = effects.colorCorrection ? 'block' : 'none';
            document.getElementById('colorFilter').value = effects.colorFilter || 'none';
            document.getElementById('enableVignette').checked = effects.vignette || false;
            document.getElementById('vignetteSettings').style.display = effects.vignette ? 'block' : 'none';
            document.getElementById('vignetteIntensity').value = effects.vignetteIntensity || 40;
            document.getElementById('vignetteIntensityValue').textContent = (effects.vignetteIntensity || 40) + '%';
            
            // –ê—É–¥–∏–æ
            document.getElementById('audioPitch').value = effects.audioPitch || '0';
            document.getElementById('audioEffect').value = effects.audioEffect || 'none';
            document.getElementById('audioStereoEnhance').checked = effects.audioStereoEnhance || false;
            document.getElementById('audioNormalize').checked = effects.audioNormalize !== false;
            
            // –ü–ª–∞–≤–Ω–æ—Å—Ç—å
            document.getElementById('easingType').value = effects.easingType || 'ease';
            document.getElementById('bezierSettings').style.display = effects.easingType === 'bezier' ? 'block' : 'none';
            document.getElementById('bezierP1').value = effects.bezierP1 || 25;
            document.getElementById('bezierP1Value').textContent = effects.bezierP1 || 25;
            document.getElementById('bezierP2').value = effects.bezierP2 || 75;
            document.getElementById('bezierP2Value').textContent = effects.bezierP2 || 75;
        }

        function saveChannelEffects() {
            if (!currentChannelId) return;
            
            const channel = channels.find(c => c.id === currentChannelId);
            if (!channel) return;
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const effects = {
                kenBurns: [],
                kenBurnsIntensity: parseInt(document.getElementById('kbIntensity').value),
                rotationAngle: parseInt(document.getElementById('rotationAngle').value),
                smartCrop: document.getElementById('kbSmartCrop').checked,
                scaleEffects: [],
                scaleAmplitude: parseInt(document.getElementById('scaleAmplitude').value),
                transitions: [],
                transitionDuration: parseFloat(document.getElementById('transitionDuration').value),
                colorCorrection: document.getElementById('enableColorCorrection').checked,
                colorFilter: document.getElementById('colorFilter').value,
                vignette: document.getElementById('enableVignette').checked,
                vignetteIntensity: parseInt(document.getElementById('vignetteIntensity').value),
                audioPitch: document.getElementById('audioPitch').value,
                audioEffect: document.getElementById('audioEffect').value,
                audioStereoEnhance: document.getElementById('audioStereoEnhance').checked,
                audioNormalize: document.getElementById('audioNormalize').checked,
                easingType: document.getElementById('easingType').value,
                bezierP1: parseInt(document.getElementById('bezierP1').value),
                bezierP2: parseInt(document.getElementById('bezierP2').value)
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            document.querySelectorAll('.kb-effect:checked').forEach(cb => {
                effects.kenBurns.push(cb.id.replace('kb_', ''));
            });
            
            document.querySelectorAll('.scale-effect:checked').forEach(cb => {
                effects.scaleEffects.push(cb.id.replace('scale_', ''));
            });
            
            document.querySelectorAll('.transition-effect:checked').forEach(cb => {
                effects.transitions.push(cb.id.replace('trans_', ''));
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            channel.effects = effects;
            saveChannels();
            log(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã`, 'info');
        }

        function resetChannelEffects() {
            if (!currentChannelId) return;
            
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                const channel = channels.find(c => c.id === currentChannelId);
                if (!channel) return;
                
                channel.effects = {
                    kenBurns: [],
                    kenBurnsIntensity: 30,
                    rotationAngle: 5,
                    smartCrop: true,
                    scaleEffects: [],
                    scaleAmplitude: 10,
                    transitions: ['fade'],
                    transitionDuration: 1.0,
                    colorCorrection: false,
                    colorFilter: 'none',
                    vignette: false,
                    vignetteIntensity: 40,
                    audioPitch: '0',
                    audioEffect: 'none',
                    audioStereoEnhance: false,
                    audioNormalize: true,
                    easingType: 'ease',
                    bezierP1: 25,
                    bezierP2: 75
                };
                
                saveChannels();
                loadChannelEffects();
                log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
            }
        }

        function previewEffects() {
            alert('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
        }

        // === –ò–ú–ü–û–†–¢/–≠–ö–°–ü–û–†–¢ –ö–ê–ù–ê–õ–û–í ===

        function exportChannels() {
            const dataStr = JSON.stringify(channels, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'automontage_channels_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            
            log('–ö–∞–Ω–∞–ª—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'info');
        }

        function importChannels() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedChannels = JSON.parse(event.target.result);
                        
                        if (Array.isArray(importedChannels)) {
                            channels = importedChannels;
                            saveChannels();
                            updateChannelLists();
                            log('–ö–∞–Ω–∞–ª—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'info');
                        } else {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                    } catch (err) {
                        alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + err.message);
                        log('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–∞–Ω–∞–ª–æ–≤', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // === –ì–ï–ù–ï–†–ê–¶–ò–Ø –ú–û–ù–¢–ê–ñ–ê ===

        function importFiles() {
            if (!PROJECT_FOLDER) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞!");
                return;
            }
            
            updateProgress(0, "–ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤...");
            log("–ù–∞—á–∏–Ω–∞–µ–º –∏–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç", 'info');
            
            const extScript = `
                function importProjectFiles(folderPath) {
                    try {
                        var project = app.project;
                        if (!project) return "ERROR: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞";
                        
                        var folder = new Folder(folderPath);
                        if (!folder.exists) return "ERROR: –ü–∞–ø–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç";
                        
                        var importBin = project.rootItem.createBin("Auto Montage Import " + new Date().toLocaleString());
                        var files = folder.getFiles();
                        var importedCount = 0;
                        
                        var supportedFormats = ['.jpg', '.jpeg', '.png', '.tiff', '.bmp', '.mp3', '.wav', '.aiff', '.m4a'];
                        
                        for (var i = 0; i < files.length; i++) {
                            if (files[i] instanceof File) {
                                var ext = files[i].name.substr(files[i].name.lastIndexOf('.')).toLowerCase();
                                if (supportedFormats.indexOf(ext) > -1) {
                                    project.importFiles([files[i].fsName], false, importBin, false);
                                    importedCount++;
                                }
                            }
                        }
                        
                        return "SUCCESS: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ " + importedCount + " —Ñ–∞–π–ª–æ–≤";
                        
                    } catch(e) {
                        return "ERROR: " + e.toString();
                    }
                }
                
                importProjectFiles("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}");
            `;
            
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    if (result.indexOf("SUCCESS") === 0) {
                        updateProgress(100, "–§–∞–π–ª—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã");
                        log(result, 'info');
                    } else {
                        updateProgress(0, "–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞");
                        log(result, 'error');
                    }
                });
            } else {
                setTimeout(() => {
                    updateProgress(100, "–§–∞–π–ª—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (—Å–∏–º—É–ª—è—Ü–∏—è)");
                    log("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 10 —Ñ–∞–π–ª–æ–≤ (—Å–∏–º—É–ª—è—Ü–∏—è)", 'info');
                }, 1500);
            }
        }

        async function generateMontage() {
            if (!PROJECT_FOLDER) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞!");
                return;
            }
            
            if (selectedChannels.size === 0) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!");
                return;
            }
            
            isGenerating = true;
            generationAborted = false;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('cancelButton').classList.add('show');
            
            log(`–ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è ${selectedChannels.size} –∫–∞–Ω–∞–ª–æ–≤`, 'info');
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
            await prepareAudioFiles();
            
            if (generationAborted) {
                finishGeneration();
                return;
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
            let channelIndex = 0;
            for (const channelId of selectedChannels) {
                if (generationAborted) break;
                
                const channel = channels.find(c => c.id === channelId);
                if (!channel) continue;
                
                channelIndex++;
                updateProgress(
                    (channelIndex / selectedChannels.size) * 100,
                    `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–Ω–∞–ª–∞: ${channel.name}`
                );
                
                await generateChannelMontage(channel);
            }
            
            finishGeneration();
        }

        function finishGeneration() {
            isGenerating = false;
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('cancelButton').classList.remove('show');
            updateProgress(100, generationAborted ? "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞" : "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!");
            log(generationAborted ? "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º" : "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ", 
                generationAborted ? 'warning' : 'info');
        }

        function cancelGeneration() {
            if (confirm('–û—Ç–º–µ–Ω–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é?')) {
                generationAborted = true;
                log('–û—Ç–º–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...', 'warning');
            }
        }

        async function prepareAudioFiles() {
            return new Promise((resolve) => {
                updateProgress(10, "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤...");
                
                // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
                const audioSettings = new Set();
                for (const channelId of selectedChannels) {
                    const channel = channels.find(c => c.id === channelId);
                    if (channel) {
                        const key = `${channel.effects.audioPitch}_${channel.effects.audioEffect}`;
                        audioSettings.add(key);
                    }
                }
                
                log(`–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å ${audioSettings.size} –∞—É–¥–∏–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤`, 'info');
                
                const extScript = `
                    function prepareAudioVariants(folderPath, variants) {
                        try {
                            // –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                            var variantsFolder = new Folder(folderPath + "/audio_variants");
                            if (!variantsFolder.exists) variantsFolder.create();
                            
                            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ FFmpeg
                            // –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è bat —Ñ–∞–π–ª
                            
                            return "SUCCESS: –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã";
                        } catch(e) {
                            return "ERROR: " + e.toString();
                        }
                    }
                    
                    var variants = ${JSON.stringify(Array.from(audioSettings))};
                    prepareAudioVariants("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}", variants);
                `;
                
                if (typeof CSInterface !== 'undefined') {
                    const csInterface = new CSInterface();
                    csInterface.evalScript(extScript, function(result) {
                        log(result, result.startsWith('SUCCESS') ? 'info' : 'error');
                        resolve();
                    });
                } else {
                    setTimeout(() => {
                        log("–ê—É–¥–∏–æ —Ñ–∞–π–ª—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã (—Å–∏–º—É–ª—è—Ü–∏—è)", 'info');
                        resolve();
                    }, 2000);
                }
            });
        }

        async function generateChannelMontage(channel) {
            return new Promise((resolve) => {
                log(`–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω—Ç–∞–∂–∞ –¥–ª—è –∫–∞–Ω–∞–ª–∞: ${channel.name}`, 'info');
                
                const config = {
                    channelName: channel.name,
                    template: EXPORT_PRESETS[channel.template],
                    effects: channel.effects,
                    projectFolder: PROJECT_FOLDER,
                    audioVariantsFolder: AUDIO_VARIANTS_FOLDER,
                    exportMode: document.getElementById('exportMode').value,
                    outputFormat: document.getElementById('outputFormat').value
                };
                
                const extScript = `
                    ${getMontageFunctions()}
                    
                    try {
                        var config = ${JSON.stringify(config)};
                        var result = createChannelMontage(config);
                        JSON.stringify(result);
                    } catch(e) {
                        JSON.stringify({success: false, error: e.toString()});
                    }
                `;
                
                if (typeof CSInterface !== 'undefined') {
                    const csInterface = new CSInterface();
                    csInterface.evalScript(extScript, function(result) {
                        try {
                            const response = JSON.parse(result);
                            if (response.success) {
                                log(`–ú–æ–Ω—Ç–∞–∂ –¥–ª—è –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ–∑–¥–∞–Ω`, 'info');
                            } else {
                                log(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–Ω—Ç–∞–∂–∞: ${response.error}`, 'error');
                            }
                        } catch(e) {
                            log('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞', 'error');
                        }
                        resolve();
                    });
                } else {
                    setTimeout(() => {
                        log(`–ú–æ–Ω—Ç–∞–∂ –¥–ª—è –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ–∑–¥–∞–Ω (—Å–∏–º—É–ª—è—Ü–∏—è)`, 'info');
                        resolve();
                    }, 3000);
                }
            });
        }

        function getMontageFunctions() {
            return `
                function createChannelMontage(config) {
                    var project = app.project;
                    if (!project) {
                        return {success: false, error: "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞"};
                    }
                    
                    try {
                        // –°–æ–∑–¥–∞–µ–º —Å–µ–∫–≤–µ–Ω—Ü–∏—é
                        var sequenceName = "Montage_" + config.channelName + "_" + new Date().getTime();
                        var sequence = project.createNewSequence(sequenceName, "");
                        
                        if (!sequence) {
                            return {success: false, error: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–µ–∫–≤–µ–Ω—Ü–∏—é"};
                        }
                        
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ–∫–≤–µ–Ω—Ü–∏–∏
                        sequence.name = sequenceName;
                        
                        // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–Ω—Ç–∞–∂–∞
                        // –≤–∫–ª—é—á–∞—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏–∑ config.effects
                        
                        return {success: true, sequenceName: sequenceName};
                        
                    } catch(e) {
                        return {success: false, error: e.toString()};
                    }
                }
            `;
        }

        // === –ù–ê–°–¢–†–û–ô–ö–ò ===

        function loadSettings() {
            const stored = localStorage.getItem('autoMontageSettings');
            if (stored) {
                try {
                    const settings = JSON.parse(stored);
                    
                    document.getElementById('ffmpegPath').value = settings.ffmpegPath || 'ffmpeg.exe';
                    document.getElementById('amePath').value = settings.amePath || '';
                    document.getElementById('renderThreads').value = settings.renderThreads || 4;
                    document.getElementById('renderThreadsValue').textContent = settings.renderThreads || 4;
                    document.getElementById('useGPU').checked = settings.useGPU !== false;
                    document.getElementById('useProxies').checked = settings.useProxies || false;
                    document.getElementById('transcodeRussian').checked = settings.transcodeRussian !== false;
                    document.getElementById('autoSave').checked = settings.autoSave !== false;
                    document.getElementById('keepSourceAudio').checked = settings.keepSourceAudio !== false;
                } catch(e) {
                    log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'warning');
                }
            }
        }

        function saveSettings() {
            const settings = {
                ffmpegPath: document.getElementById('ffmpegPath').value,
                amePath: document.getElementById('amePath').value,
                renderThreads: parseInt(document.getElementById('renderThreads').value),
                useGPU: document.getElementById('useGPU').checked,
                useProxies: document.getElementById('useProxies').checked,
                transcodeRussian: document.getElementById('transcodeRussian').checked,
                autoSave: document.getElementById('autoSave').checked,
                keepSourceAudio: document.getElementById('keepSourceAudio').checked
            };
            
            localStorage.setItem('autoMontageSettings', JSON.stringify(settings));
            log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'info');
        }

        function resetSettings() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                localStorage.removeItem('autoMontageSettings');
                loadSettings();
                log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
            }
        }

        function browsePath(type) {
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                
                let filter = type === 'ffmpeg' ? 'ffmpeg.exe' : 'Adobe Media Encoder.exe';
                let title = type === 'ffmpeg' ? '–í—ã–±–µ—Ä–∏—Ç–µ ffmpeg.exe' : '–í—ã–±–µ—Ä–∏—Ç–µ Adobe Media Encoder.exe';
                
                const extScript = `
                    var file = File.openDialog("${title}", "${filter}");
                    if (file) {
                        file.fsName;
                    } else {
                        null;
                    }
                `;
                
                csInterface.evalScript(extScript, function(result) {
                    if (result && result !== 'null') {
                        document.getElementById(`${type}Path`).value = result;
                        log(`–í—ã–±—Ä–∞–Ω –ø—É—Ç—å ${type}: ${result}`, 'info');
                    }
                });
            } else {
                alert('–í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ Premiere Pro');
            }
        }

        // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            if (modalId === 'channelModal') {
                document.getElementById('newChannelName').value = '';
                document.getElementById('newChannelDescription').value = '';
                document.getElementById('newChannelTemplate').value = 'YouTube';
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        if (document.getElementById('autoSave')) {
            setInterval(() => {
                if (document.getElementById('autoSave').checked && typeof CSInterface !== 'undefined') {
                    const csInterface = new CSInterface();
                    csInterface.evalScript('app.project.save()', function() {
                        log('–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'info');
                    });
                }
            }, 300000); // –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
        });
    </script>

    <!-- CEP JavaScript API -->
    <script src="./js/CSInterface.js"></script>
</body>
</html>
