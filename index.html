<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Montage Builder Pro - Complete Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        }

        body {
            background: #0f0f23;
            color: #ffffff;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
            min-width: 900px;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 900px;
        }

        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #4CAF50;
            text-align: center;
            margin: 0;
        }

        .tabs-container {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tabs {
            display: flex;
            padding: 0;
            margin: 0;
            min-width: 900px;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            border: none;
            background: transparent;
            color: #ffffff;
            opacity: 0.7;
            position: relative;
            white-space: nowrap;
        }

        .tab:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            opacity: 1;
            background: rgba(76, 175, 80, 0.1);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #4CAF50;
        }

        .tab-content {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h3 {
            margin-bottom: 15px;
            color: #4CAF50;
            font-size: 16px;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #cccccc;
        }

        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-row label {
            margin-bottom: 0;
            min-width: 140px;
            font-size: 13px;
        }

        input[type="text"], 
        input[type="number"], 
        select {
            flex: 1;
            min-width: 150px;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 13px;
        }

        select {
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 35px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        select option {
            background: #1a1a2e;
            color: #ffffff;
            padding: 10px;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus, 
        select:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(255, 255, 255, 0.15);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #81C784);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: 500;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .info-panel {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-text {
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-line;
        }

        .warning-panel {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        /* –ö–∞–Ω–∞–ª—ã */
        .channel-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .channel-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .channel-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(76, 175, 80, 0.5);
            transform: translateY(-2px);
        }

        .channel-card.selected {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }

        .channel-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .channel-info {
            font-size: 11px;
            color: #999;
            margin-bottom: 3px;
        }

        .channel-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .channel-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .channel-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–µ */
        .effects-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .effects-grid {
                grid-template-columns: 1fr;
            }
        }

        /* –ß–µ–∫–±–æ–∫—Å—ã –∏ —Ä–∞–¥–∏–æ */
        .checkbox-group,
        .radio-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #4CAF50;
        }

        /* –°–ª–∞–π–¥–µ—Ä—ã */
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .slider-group label {
            min-width: 140px;
            margin-bottom: 0;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb:hover {
            background: #81C784;
            transform: scale(1.2);
        }

        .slider-value {
            min-width: 50px;
            text-align: center;
            font-size: 12px;
            color: #4CAF50;
            font-weight: 500;
        }

        /* –õ–æ–≥–∏ */
        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            height: 150px;
            overflow-y: auto;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 11px;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 2px;
            padding: 2px 0;
        }

        .log-info { color: #4CAF50; }
        .log-warning { color: #ff9800; }
        .log-error { color: #f44336; }

        /* –°–ø–∏—Å–æ–∫ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ */
        .effects-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .effect-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            transition: all 0.2s;
        }

        .effect-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .effect-item input:checked + label {
            color: #4CAF50;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #4CAF50;
            font-size: 20px;
            margin: 0;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(76, 175, 80, 0.6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 175, 80, 0.8);
        }

        /* –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã */
        .cancel-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
            transition: all 0.3s ease;
        }

        .cancel-button.show {
            display: flex;
        }

        .cancel-button:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        /* –¢–µ–≥–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        .tag {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            border-radius: 16px;
            font-size: 11px;
            margin: 2px;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        /* –°–µ–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section h4 {
            color: #81C784;
            font-size: 14px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* –ö–æ–ª–æ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        .effects-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1000px) {
            .effects-columns {
                grid-template-columns: 1fr;
            }
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            margin-bottom: 5px;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #4CAF50;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 1200px) {
            .container {
                min-width: 800px;
            }
            
            .tabs {
                min-width: 800px;
            }
            
            .channel-list {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π */
        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }

        /* –¶–≤–µ—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        .effect-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .effect-indicator.active {
            background: #4CAF50;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        .effect-indicator.inactive {
            background: rgba(255, 255, 255, 0.3);
        }

        /* –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .quick-settings {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .quick-setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤—ã—Ö –ø—É—Ç–µ–π */
        .file-path {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            font-size: 12px;
            word-break: break-all;
        }

        .file-path-icon {
            font-size: 16px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        @keyframes slideInLeft {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideInLeft 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ AUTO MONTAGE BUILDER PRO - COMPLETE EDITION</h1>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="generation">üé¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
                <button class="tab" data-tab="channels">üì∫ –ö–∞–Ω–∞–ª—ã</button>
                <button class="tab" data-tab="effects">üé® –≠—Ñ—Ñ–µ–∫—Ç—ã</button>
                <button class="tab" data-tab="overlays">üé≠ –û–≤–µ—Ä–ª–µ–∏</button>
                <button class="tab" data-tab="capcut">‚ú® CapCut FX</button>
                <button class="tab" data-tab="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <div class="tab-content active" id="generation">
            <div class="panel">
                <h3>üìÅ –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</h3>
                <div class="form-row">
                    <input type="text" id="projectPath" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å —Ñ–∞–π–ª–∞–º–∏ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/–≤–∏–¥–µ–æ + –∞—É–¥–∏–æ)" readonly>
                    <button class="btn btn-secondary" onclick="selectProjectFolder()">–û–±–∑–æ—Ä...</button>
                </div>
                <div class="checkbox-group" style="margin-top: 10px;">
                    <input type="checkbox" id="includeVideos" checked>
                    <label for="includeVideos">–í–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ —Ñ–∞–π–ª—ã (MP4, MOV, AVI)</label>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-text" id="projectInfo">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã:
‚Ä¢ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: JPG, PNG, TIFF, BMP
‚Ä¢ –í–∏–¥–µ–æ: MP4, MOV, AVI, MKV
‚Ä¢ –ê—É–¥–∏–æ: MP3, WAV, M4A, FLAC</div>
            </div>

            <div class="panel">
                <h3>üì∫ –í—ã–±–æ—Ä –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3>
                <div class="channel-list" id="generationChannelList">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è -->
                </div>
                <div class="quick-settings">
                    <button class="btn btn-small btn-secondary" onclick="selectAllChannels()">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                    <button class="btn btn-small btn-secondary" onclick="deselectAllChannels()">–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ</button>
                </div>
            </div>

            <div class="panel">
                <h3>üéµ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ</h3>
                <div class="checkbox-group">
                    <input type="checkbox" id="processAudioFirst" checked>
                    <label for="processAudioFirst">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∞—É–¥–∏–æ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π</label>
                </div>
                <div class="info-text" style="font-size: 12px; color: #999; margin-top: 10px;">
                    –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="testMontage()">üß™ –¢–µ—Å—Ç (1 –ø–∞—Ä–∞)</button>
                <button class="btn btn-secondary" onclick="importFiles()">üìÇ –ò–º–ø–æ—Ä—Ç –≤ –ø—Ä–æ–µ–∫—Ç</button>
                <button class="btn btn-primary" onclick="generateMontage()" id="generateBtn">
                    üé¨ –°–û–ó–î–ê–¢–¨ –ú–û–ù–¢–ê–ñ
                </button>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                    <div class="progress-text" id="progressText">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
                </div>
            </div>

            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
                <div class="log-entry log-info">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: Adobe Premiere Pro 2020+</div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö–∞–Ω–∞–ª—ã -->
        <div class="tab-content" id="channels">
            <div class="panel">
                <h3>üì∫ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏</h3>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="createChannel()">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª</button>
                    <button class="btn btn-secondary" onclick="importChannels()">üì• –ò–º–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" onclick="exportChannels()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" onclick="createChannelFromTemplate()">üìã –ò–∑ —à–∞–±–ª–æ–Ω–∞</button>
                </div>
            </div>

            <div class="panel">
                <h3>üìã –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤</h3>
                <div class="channel-list" id="channelList">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è -->
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –≠—Ñ—Ñ–µ–∫—Ç—ã -->
        <div class="tab-content" id="effects">
            <div class="panel">
                <h3>üì∫ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</h3>
                <select id="channelSelector" onchange="loadChannelEffects()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>
                </select>
            </div>

            <div id="effectsEditor" style="display: none;">
                <div class="effects-columns">
                    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
                        <div class="panel">
                            <h3>üì§ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
                            <div class="form-row">
                                <label>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</label>
                                <select id="channelResolution">
                                    <option value="1920x1080">1920√ó1080 (Full HD)</option>
                                    <option value="3840x2160">3840√ó2160 (4K)</option>
                                    <option value="1280x720">1280√ó720 (HD)</option>
                                    <option value="1080x1920">1080√ó1920 (–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ)</option>
                                    <option value="1080x1080">1080√ó1080 (–ö–≤–∞–¥—Ä–∞—Ç)</option>
                                    <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ</option>
                                </select>
                            </div>
                            
                            <div id="customResolution" style="display: none;">
                                <div class="form-row">
                                    <label>–®–∏—Ä–∏–Ω–∞:</label>
                                    <input type="number" id="customWidth" value="1920" min="320" max="7680">
                                    <label>–í—ã—Å–æ—Ç–∞:</label>
                                    <input type="number" id="customHeight" value="1080" min="240" max="4320">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <label>FPS:</label>
                                <select id="channelFps">
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="30" selected>30</option>
                                    <option value="50">50</option>
                                    <option value="60">60</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label>–ë–∏—Ç—Ä–µ–π—Ç (Mbps):</label>
                                <input type="number" id="channelBitrate" value="8" min="1" max="100">
                            </div>
                            
                            <div class="form-row">
                                <label>–ö–æ–¥–µ–∫:</label>
                                <select id="channelCodec">
                                    <option value="h264">H.264</option>
                                    <option value="h265">H.265/HEVC</option>
                                    <option value="prores">ProRes</option>
                                </select>
                            </div>
                        </div>

                        <!-- Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã -->
                        <div class="panel">
                            <h3>üé¨ Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                            <div class="effects-list">
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_zoomIn" class="kb-effect">
                                    <label for="kb_zoomIn">Zoom In (–ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_zoomOut" class="kb-effect">
                                    <label for="kb_zoomOut">Zoom Out (–æ—Ç–¥–∞–ª–µ–Ω–∏–µ)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_panLeft" class="kb-effect">
                                    <label for="kb_panLeft">Pan Left (–≤–ª–µ–≤–æ)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_panRight" class="kb-effect">
                                    <label for="kb_panRight">Pan Right (–≤–ø—Ä–∞–≤–æ)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_panUp" class="kb-effect">
                                    <label for="kb_panUp">Pan Up (–≤–≤–µ—Ä—Ö)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_panDown" class="kb-effect">
                                    <label for="kb_panDown">Pan Down (–≤–Ω–∏–∑)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_rotate" class="kb-effect">
                                    <label for="kb_rotate">Rotate (–≤—Ä–∞—â–µ–Ω–∏–µ)</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="kb_diagonal" class="kb-effect">
                                    <label for="kb_diagonal">Diagonal (–¥–∏–∞–≥–æ–Ω–∞–ª—å)</label>
                                </div>
                            </div>
                            
                            <div class="slider-group">
                                <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                                <input type="range" id="kbIntensity" class="slider" min="0" max="100" value="30">
                                <span class="slider-value" id="kbIntensityValue">30%</span>
                            </div>
                            
                            <div class="slider-group">
                                <label>–£–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è:</label>
                                <input type="range" id="rotationAngle" class="slider" min="0" max="45" value="5">
                                <span class="slider-value" id="rotationAngleValue">5¬∞</span>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="kbSmartCrop" checked>
                                <label for="kbSmartCrop">–£–º–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ (–±–µ–∑ —á–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Å)</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="kbRandomize">
                                <label for="kbRandomize">–†–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–ø–∞</label>
                            </div>
                        </div>

                        <!-- –ê—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                        <div class="panel">
                            <h3>üéµ –ê—É–¥–∏–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                            <div class="form-row">
                                <label>–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</label>
                                <select id="audioPitch">
                                    <option value="-3">-3 (–æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π)</option>
                                    <option value="-2">-2 (–Ω–∏–∑–∫–∏–π)</option>
                                    <option value="-1.5">-1.5</option>
                                    <option value="-1">-1</option>
                                    <option value="-0.5">-0.5</option>
                                    <option value="0" selected>0 (–æ—Ä–∏–≥–∏–Ω–∞–ª)</option>
                                    <option value="+0.5">+0.5</option>
                                    <option value="+1">+1</option>
                                    <option value="+1.5">+1.5</option>
                                    <option value="+2">+2 (–≤—ã—Å–æ–∫–∏–π)</option>
                                    <option value="+3">+3 (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π)</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label>–≠—Ñ—Ñ–µ–∫—Ç:</label>
                                <select id="audioEffect">
                                    <option value="none">–ë–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞</option>
                                    <option value="bass">–£—Å–∏–ª–µ–Ω–∏–µ –±–∞—Å–æ–≤</option>
                                    <option value="reverb">–†–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—è</option>
                                    <option value="echo">–≠—Ö–æ</option>
                                    <option value="chorus">–•–æ—Ä—É—Å</option>
                                    <option value="telephone">–¢–µ–ª–µ—Ñ–æ–Ω</option>
                                    <option value="underwater">–ü–æ–¥ –≤–æ–¥–æ–π</option>
                                    <option value="radio">–†–∞–¥–∏–æ</option>
                                    <option value="vintage">–í–∏–Ω—Ç–∞–∂</option>
                                </select>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="audioStereoEnhance">
                                <label for="audioStereoEnhance">–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—Ç–µ—Ä–µ–æ</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="audioNormalize" checked>
                                <label for="audioNormalize">–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏</label>
                            </div>
                        </div>
                    </div>

                    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –ü–µ—Ä–µ—Ö–æ–¥—ã -->
                        <div class="panel">
                            <h3>üîÑ –ü–µ—Ä–µ—Ö–æ–¥—ã</h3>
                            <div class="effects-list">
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_fade" class="transition-effect">
                                    <label for="trans_fade">Fade</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_dissolve" class="transition-effect">
                                    <label for="trans_dissolve">Cross Dissolve</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_dip_black" class="transition-effect">
                                    <label for="trans_dip_black">Dip to Black</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_dip_white" class="transition-effect">
                                    <label for="trans_dip_white">Dip to White</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_wipe" class="transition-effect">
                                    <label for="trans_wipe">Wipe</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_slide" class="transition-effect">
                                    <label for="trans_slide">Slide</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_push" class="transition-effect">
                                    <label for="trans_push">Push</label>
                                </div>
                                <div class="effect-item">
                                    <input type="checkbox" id="trans_zoom" class="transition-effect">
                                    <label for="trans_zoom">Zoom</label>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</label>
                                <input type="number" id="transitionDuration" value="1.0" min="0.1" max="3.0" step="0.1">
                                <span>—Å–µ–∫—É–Ω–¥</span>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="transRandomize">
                                <label for="transRandomize">–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ø–µ—Ä–µ—Ö–æ–¥–æ–≤</label>
                            </div>
                        </div>

                        <!-- –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è -->
                        <div class="panel">
                            <h3>üé® –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è</h3>
                            <div class="checkbox-group">
                                <input type="checkbox" id="enableColorCorrection">
                                <label for="enableColorCorrection">–í–∫–ª—é—á–∏—Ç—å —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é</label>
                            </div>
                            
                            <div id="colorCorrectionSettings" style="display: none;">
                                <div class="form-row">
                                    <label>–§–∏–ª—å—Ç—Ä:</label>
                                    <select id="colorFilter">
                                        <option value="none">–ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞</option>
                                        <option value="warm">–¢–µ–ø–ª—ã–π</option>
                                        <option value="cold">–•–æ–ª–æ–¥–Ω—ã–π</option>
                                        <option value="vintage">–í–∏–Ω—Ç–∞–∂</option>
                                        <option value="blackwhite">–ß–µ—Ä–Ω–æ-–±–µ–ª—ã–π</option>
                                        <option value="sepia">–°–µ–ø–∏—è</option>
                                        <option value="cinematic">–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π</option>
                                        <option value="vibrant">–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π</option>
                                        <option value="faded">–í—ã—Ü–≤–µ—Ç—à–∏–π</option>
                                    </select>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableVignette">
                                    <label for="enableVignette">–í–∏–Ω—å–µ—Ç–∫–∞</label>
                                </div>
                                
                                <div class="slider-group" id="vignetteSettings" style="display: none;">
                                    <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                                    <input type="range" id="vignetteIntensity" class="slider" min="0" max="100" value="40">
                                    <span class="slider-value" id="vignetteIntensityValue">40%</span>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableGrain">
                                    <label for="enableGrain">–ó–µ—Ä–Ω–æ –ø–ª–µ–Ω–∫–∏</label>
                                </div>
                                
                                <div class="slider-group" id="grainSettings" style="display: none;">
                                    <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                                    <input type="range" id="grainIntensity" class="slider" min="0" max="100" value="20">
                                    <span class="slider-value" id="grainIntensityValue">20%</span>
                                </div>
                            </div>
                        </div>

                        <!-- –ü–ª–∞–≤–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ -->
                        <div class="panel">
                            <h3>‚ö° –ü–ª–∞–≤–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</h3>
                            <div class="form-row">
                                <label>–¢–∏–ø –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏:</label>
                                <select id="easingType">
                                    <option value="linear">–õ–∏–Ω–µ–π–Ω–∞—è</option>
                                    <option value="ease" selected>–ü–ª–∞–≤–Ω–∞—è</option>
                                    <option value="ease-in">–£—Å–∫–æ—Ä–µ–Ω–∏–µ</option>
                                    <option value="ease-out">–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ</option>
                                    <option value="ease-in-out">–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ</option>
                                    <option value="bezier">–ö—Ä–∏–≤–∞—è –ë–µ–∑—å–µ</option>
                                    <option value="bounce">–û—Ç—Å–∫–æ–∫</option>
                                    <option value="elastic">–≠–ª–∞—Å—Ç–∏—á–Ω–∞—è</option>
                                </select>
                            </div>
                            
                            <div id="bezierSettings" style="display: none;">
                                <div class="slider-group">
                                    <label>–¢–æ—á–∫–∞ 1:</label>
                                    <input type="range" id="bezierP1" class="slider" min="0" max="100" value="25">
                                    <span class="slider-value" id="bezierP1Value">25</span>
                                </div>
                                <div class="slider-group">
                                    <label>–¢–æ—á–∫–∞ 2:</label>
                                    <input type="range" id="bezierP2" class="slider" min="0" max="100" value="75">
                                    <span class="slider-value" id="bezierP2Value">75</span>
                                </div>
                            </div>
                        </div>

                        <!-- 3D —ç—Ñ—Ñ–µ–∫—Ç—ã -->
                        <div class="panel">
                            <h3>üéØ 3D —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                            <div class="checkbox-group">
                                <input type="checkbox" id="enable3D">
                                <label for="enable3D">–í–∫–ª—é—á–∏—Ç—å 3D –¥–≤–∏–∂–µ–Ω–∏–µ</label>
                            </div>
                            
                            <div id="3dSettings" style="display: none;">
                                <div class="form-row">
                                    <label>–¢–∏–ø 3D:</label>
                                    <select id="3dType">
                                        <option value="basic">–ë–∞–∑–æ–≤—ã–π –ø–æ–≤–æ—Ä–æ—Ç</option>
                                        <option value="parallax">–ü–∞—Ä–∞–ª–ª–∞–∫—Å (—Å–ª–æ–∏)</option>
                                        <option value="depth">–ì–ª—É–±–∏–Ω–∞ (—Ç—Ä–µ–±—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏)</option>
                                    </select>
                                </div>
                                
                                <div class="slider-group">
                                    <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                                    <input type="range" id="3dIntensity" class="slider" min="0" max="100" value="20">
                                    <span class="slider-value" id="3dIntensityValue">20%</span>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="3dAutoRotate">
                                    <label for="3dAutoRotate">–ê–≤—Ç–æ–≤—Ä–∞—â–µ–Ω–∏–µ</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveChannelEffects()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn btn-secondary" onclick="resetChannelEffects()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="previewEffects()">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                    <button class="btn btn-secondary" onclick="duplicateToChannel()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤...</button>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –û–≤–µ—Ä–ª–µ–∏ -->
        <div class="tab-content" id="overlays">
            <div class="panel">
                <h3>üé≠ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–≤–µ—Ä–ª–µ—è–º–∏</h3>
                <div class="form-row">
                    <label>–ü–∞–ø–∫–∞ —Å –æ–≤–µ—Ä–ª–µ—è–º–∏:</label>
                    <input type="text" id="overlaysPath" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –æ–≤–µ—Ä–ª–µ—è–º–∏" readonly>
                    <button class="btn btn-secondary" onclick="selectOverlaysFolder()">–û–±–∑–æ—Ä...</button>
                </div>
                <div class="info-text" style="margin-top: 10px; font-size: 12px;">
                    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: PNG (—Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é), MP4, MOV, GIF
                </div>
            </div>

            <div class="panel">
                <h3>üì∫ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–≤–µ—Ä–ª–µ–µ–≤ –∫–∞–Ω–∞–ª–∞–º</h3>
                <select id="overlayChannelSelector" onchange="loadChannelOverlays()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>
                </select>
                
                <div id="overlaySettings" style="display: none; margin-top: 20px;">
                    <div class="panel">
                        <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–≤–µ—Ä–ª–µ–∏</h3>
                        <div id="overlaysList" class="effects-list">
                            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è -->
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏—è</h3>
                        <div class="form-row">
                            <label>–†–µ–∂–∏–º –Ω–∞–ª–æ–∂–µ–Ω–∏—è:</label>
                            <select id="overlayBlendMode">
                                <option value="normal">Normal</option>
                                <option value="screen">Screen (–¥–ª—è –±–ª–∏–∫–æ–≤)</option>
                                <option value="overlay">Overlay</option>
                                <option value="multiply">Multiply</option>
                                <option value="add">Add</option>
                                <option value="lighten">Lighten</option>
                                <option value="darken">Darken</option>
                            </select>
                        </div>
                        
                        <div class="slider-group">
                            <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</label>
                            <input type="range" id="overlayOpacity" class="slider" min="0" max="100" value="100">
                            <span class="slider-value" id="overlayOpacityValue">100%</span>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="overlayRandomize">
                            <label for="overlayRandomize">–°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –æ–≤–µ—Ä–ª–µ–µ–≤</label>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="overlayStretch" checked>
                            <label for="overlayStretch">–†–∞—Å—Ç—è–≥–∏–≤–∞—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω</label>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="saveOverlaySettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ CapCut —ç—Ñ—Ñ–µ–∫—Ç—ã -->
        <div class="tab-content" id="capcut">
            <div class="panel">
                <h3>‚ú® CapCut-style —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                <select id="capcutChannelSelector" onchange="loadChannelCapcutEffects()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>
                </select>
            </div>

            <div id="capcutEffectsEditor" style="display: none;">
                <div class="effects-columns">
                    <!-- –ê–Ω–∏–º–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∞ -->
                    <div class="panel">
                        <h3>üîç –ê–Ω–∏–º–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∞</h3>
                        <div class="effects-list">
                            <div class="effect-item">
                                <input type="checkbox" id="fx_zoomBurst" class="capcut-effect">
                                <label for="fx_zoomBurst">Zoom Burst (—Ä–µ–∑–∫–∏–π –∑—É–º)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_pulse" class="capcut-effect">
                                <label for="fx_pulse">Pulse (–ø—É–ª—å—Å–∞—Ü–∏—è)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_bounce" class="capcut-effect">
                                <label for="fx_bounce">Bounce (–æ—Ç—Å–∫–æ–∫)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_elastic" class="capcut-effect">
                                <label for="fx_elastic">Elastic (—ç–ª–∞—Å—Ç–∏—á–Ω—ã–π)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_wave" class="capcut-effect">
                                <label for="fx_wave">Wave (–≤–æ–ª–Ω–∞)</label>
                            </div>
                        </div>
                        
                        <div class="slider-group">
                            <label>–ê–º–ø–ª–∏—Ç—É–¥–∞:</label>
                            <input type="range" id="scaleAmplitude" class="slider" min="0" max="50" value="15">
                            <span class="slider-value" id="scaleAmplitudeValue">15%</span>
                        </div>
                        
                        <div class="settings-section">
                            <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Zoom Burst</h4>
                            <div class="slider-group">
                                <label>–ù–∞—á–∞–ª—å–Ω—ã–π –∑—É–º:</label>
                                <input type="range" id="zoomBurstStart" class="slider" min="100" max="200" value="150">
                                <span class="slider-value" id="zoomBurstStartValue">150%</span>
                            </div>
                            <div class="slider-group">
                                <label>–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞—Ç—É—Ö–∞–Ω–∏—è:</label>
                                <input type="range" id="zoomBurstDecay" class="slider" min="0" max="100" value="80">
                                <span class="slider-value" id="zoomBurstDecayValue">80%</span>
                            </div>
                        </div>
                    </div>

                    <!-- –î–≤–∏–∂–µ–Ω–∏–µ –∏ —Ç—Ä—è—Å–∫–∞ -->
                    <div class="panel">
                        <h3>üéØ –î–≤–∏–∂–µ–Ω–∏–µ –∏ —Ç—Ä—è—Å–∫–∞</h3>
                        <div class="effects-list">
                            <div class="effect-item">
                                <input type="checkbox" id="fx_shake" class="capcut-effect">
                                <label for="fx_shake">Shake (—Ç—Ä—è—Å–∫–∞)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_wobble" class="capcut-effect">
                                <label for="fx_wobble">Wobble (–ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_pendulum" class="capcut-effect">
                                <label for="fx_pendulum">Pendulum (–º–∞—è—Ç–Ω–∏–∫)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_swing" class="capcut-effect">
                                <label for="fx_swing">Swing (—Ä–∞—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)</label>
                            </div>
                            <div class="effect-item">
                                <input type="checkbox" id="fx_glitch" class="capcut-effect">
                                <label for="fx_glitch">Glitch (–≥–ª–∏—Ç—á)</label>
                            </div>
                        </div>
                        
                        <div class="slider-group">
                            <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                            <input type="range" id="motionIntensity" class="slider" min="0" max="100" value="30">
                            <span class="slider-value" id="motionIntensityValue">30%</span>
                        </div>
                    </div>
                </div>

                <!-- –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è -->
                <div class="panel">
                    <h3>üìä –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</h3>
                    <div class="form-row">
                        <label>–ü—Ä–∏–º–µ–Ω—è—Ç—å –∫:</label>
                        <select id="effectFrequency">
                            <option value="all">–í—Å–µ–º –∫–ª–∏–ø–∞–º</option>
                            <option value="percent">–ü—Ä–æ—Ü–µ–Ω—Ç—É –∫–ª–∏–ø–æ–≤</option>
                            <option value="every">–ö–∞–∂–¥–æ–º—É N-–º—É –∫–ª–∏–ø—É</option>
                            <option value="random">–°–ª—É—á–∞–π–Ω–æ</option>
                        </select>
                    </div>
                    
                    <div id="frequencySettings">
                        <div class="slider-group" id="percentSettings" style="display: none;">
                            <label>–ü—Ä–æ—Ü–µ–Ω—Ç –∫–ª–∏–ø–æ–≤:</label>
                            <input type="range" id="effectPercent" class="slider" min="0" max="100" value="50">
                            <span class="slider-value" id="effectPercentValue">50%</span>
                        </div>
                        
                        <div class="form-row" id="everySettings" style="display: none;">
                            <label>–ö–∞–∂–¥—ã–π:</label>
                            <input type="number" id="effectEvery" value="3" min="2" max="10">
                            <span>–∫–ª–∏–ø</span>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="avoidRepetition" checked>
                        <label for="avoidRepetition">–ò–∑–±–µ–≥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –ø–æ–¥—Ä—è–¥</label>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveCapcutEffects()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="presetCapcutEffects('dynamic')">üé¨ –ü—Ä–µ—Å–µ—Ç: –î–∏–Ω–∞–º–∏—á–Ω—ã–π</button>
                    <button class="btn btn-secondary" onclick="presetCapcutEffects('smooth')">üåä –ü—Ä–µ—Å–µ—Ç: –ü–ª–∞–≤–Ω—ã–π</button>
                    <button class="btn btn-secondary" onclick="presetCapcutEffects('epic')">‚ö° –ü—Ä–µ—Å–µ—Ç: –≠–ø–∏—á–Ω—ã–π</button>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="tab-content" id="settings">
            <div class="panel">
                <h3>üìÅ –ü—É—Ç–∏ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º</h3>
                <div class="form-group">
                    <label>FFmpeg:</label>
                    <div class="form-row">
                        <input type="text" id="ffmpegPath" value="ffmpeg.exe">
                        <button class="btn btn-secondary" onclick="browsePath('ffmpeg')">...</button>
                        <button class="btn btn-small btn-secondary" onclick="downloadFFmpeg()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å</button>
                    </div>
                    <div class="info-text" style="font-size: 11px; color: #999; margin-top: 5px;">
                        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Media Encoder:</label>
                    <div class="form-row">
                        <input type="text" id="amePath" value="">
                        <button class="btn btn-secondary" onclick="browsePath('ame')">...</button>
                        <button class="btn btn-small btn-secondary" onclick="findMediaEncoder()">üîç –ù–∞–π—Ç–∏</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Python (–¥–ª—è 3D —ç—Ñ—Ñ–µ–∫—Ç–æ–≤):</label>
                    <div class="form-row">
                        <input type="text" id="pythonPath" value="python">
                        <button class="btn btn-secondary" onclick="browsePath('python')">...</button>
                        <button class="btn btn-small btn-secondary" onclick="checkPython()">‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                <div class="slider-group">
                    <label>–ü–æ—Ç–æ–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:</label>
                    <input type="range" id="renderThreads" class="slider" min="1" max="16" value="4">
                    <span class="slider-value" id="renderThreadsValue">4</span>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="useGPU" checked>
                    <label for="useGPU">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="useProxies">
                    <label for="useProxies">–°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –¥–ª—è 4K –≤–∏–¥–µ–æ</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="preRenderEffects">
                    <label for="preRenderEffects">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —Å–ª–æ–∂–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</label>
                </div>
            </div>

            <div class="panel">
                <h3>üåê –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                <div class="checkbox-group">
                    <input type="checkbox" id="transcodeRussian" checked>
                    <label for="transcodeRussian">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="keepOriginals" checked>
                    <label for="keepOriginals">–°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="cleanupTemp">
                    <label for="cleanupTemp">–£–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</label>
                </div>
            </div>

            <div class="panel">
                <h3>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</h3>
                <div class="checkbox-group">
                    <input type="checkbox" id="autoSave" checked>
                    <label for="autoSave">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="autoBackup">
                    <label for="autoBackup">–°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="showNotifications" checked>
                    <label for="showNotifications">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏</label>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button class="btn btn-secondary" onclick="resetSettings()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="exportSettings()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn btn-secondary" onclick="importSettings()">üì• –ò–º–ø–æ—Ä—Ç</button>
            </div>

            <div class="panel" style="margin-top: 30px;">
                <h3>‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</h3>
                <div class="info-text">
                    <strong>Auto Montage Builder Pro - Complete Edition</strong><br>
                    –í–µ—Ä—Å–∏—è: 4.0.0<br>
                    –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Adobe Premiere Pro 2020+<br><br>
                    
                    <strong>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</strong><br>
                    ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω–µ<br>
                    ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤ —Å –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ–º<br>
                    ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è YouTube<br>
                    ‚Ä¢ Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —á–µ—Ä–Ω—ã—Ö –ø–æ–ª–æ—Å<br>
                    ‚Ä¢ CapCut-style –∞–Ω–∏–º–∞—Ü–∏–∏<br>
                    ‚Ä¢ –í–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–≤–µ—Ä–ª–µ–∏<br>
                    ‚Ä¢ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã<br>
                    ‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏<br>
                    ‚Ä¢ 3D —ç—Ñ—Ñ–µ–∫—Ç—ã (–±–∞–∑–æ–≤—ã–µ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ)<br>
                    ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä—É—Å—Å–∫–∏—Ö –ø—É—Ç–µ–π<br><br>
                    
                    <strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</strong> automontage@support.com
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞ -->
    <div class="modal" id="channelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞:</label>
                    <input type="text" id="newChannelName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <input type="text" id="newChannelDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞">
                </div>
                <div class="form-group">
                    <label>–ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω:</label>
                    <select id="newChannelTemplate">
                        <option value="youtube">YouTube (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ)</option>
                        <option value="shorts">Shorts/Reels (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ)</option>
                        <option value="square">Instagram (–∫–≤–∞–¥—Ä–∞—Ç)</option>
                        <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('channelModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="saveNewChannel()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —à–∞–±–ª–æ–Ω–∞ -->
    <div class="modal" id="templateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –∫–∞–Ω–∞–ª–∞</h2>
            </div>
            <div class="modal-body">
                <div class="channel-list">
                    <div class="channel-card" onclick="createFromTemplate('dynamic')">
                        <div class="channel-name">üé¨ –î–∏–Ω–∞–º–∏—á–Ω—ã–π</div>
                        <div class="channel-info">–ú–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è, –±—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã, —ç—Ñ—Ñ–µ–∫—Ç—ã CapCut</div>
                    </div>
                    <div class="channel-card" onclick="createFromTemplate('cinematic')">
                        <div class="channel-name">üé• –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π</div>
                        <div class="channel-info">–ü–ª–∞–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è, –≤–∏–Ω—å–µ—Ç–∫–∞</div>
                    </div>
                    <div class="channel-card" onclick="createFromTemplate('minimal')">
                        <div class="channel-name">‚ö™ –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π</div>
                        <div class="channel-info">–ü—Ä–æ—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</div>
                    </div>
                    <div class="channel-card" onclick="createFromTemplate('retro')">
                        <div class="channel-name">üìº –†–µ—Ç—Ä–æ</div>
                        <div class="channel-info">–í–∏–Ω—Ç–∞–∂–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –∑–µ—Ä–Ω–æ, —Å—Ç–∞—Ä–∞—è –ø–ª–µ–Ω–∫–∞</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('templateModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã -->
    <button class="cancel-button" id="cancelButton" onclick="cancelGeneration()">‚úï</button>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CSInterface
        var csInterface = null;
        
        // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof CSInterface !== 'undefined') {
                    try {
                        csInterface = new CSInterface();
                        console.log('CSInterface —Å–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                    } catch(e) {
                        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è CSInterface:', e);
                    }
                }
            }, 100);
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let PROJECT_FOLDER = null;
        let AUDIO_VARIANTS_FOLDER = null;
        let RENDERS_FOLDER = null;
        let OVERLAYS_FOLDER = null;
        let channels = [];
        let selectedChannels = new Set();
        let currentChannelId = null;
        let isGenerating = false;
        let generationAborted = false;
        let overlayFiles = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ CSInterface
            if (typeof CSInterface === 'undefined') {
                log('‚ö†Ô∏è CSInterface –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM', 'warning');
                
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
                if (window.__adobe_cep__) {
                    log('üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω __adobe_cep__, –ø—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...', 'info');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º CSInterface –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
                    var script = document.createElement('script');
                    script.src = './js/CSInterface.js';
                    script.onload = function() {
                        log('‚úÖ CSInterface.js –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏', 'info');
                        if (typeof CSInterface !== 'undefined') {
                            try {
                                csInterface = new CSInterface();
                                log('‚úÖ CSInterface —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!', 'info');
                                checkEnvironment();
                            } catch(e) {
                                log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è CSInterface: ' + e.message, 'error');
                            }
                        }
                    };
                    script.onerror = function() {
                        log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å CSInterface.js', 'error');
                    };
                    document.head.appendChild(script);
                }
            } else {
                log('‚úÖ CSInterface –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM', 'info');
                try {
                    csInterface = new CSInterface();
                    log('‚úÖ CSInterface —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', 'info');
                } catch(e) {
                    log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è CSInterface: ' + e.message, 'error');
                }
            }
            
            initializeTabs();
            loadChannels();
            loadSettings();
            setupEventListeners();
            
            // –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è
            setTimeout(checkEnvironment, 500);
            
            // –û—Ç–ª–∞–¥–∫–∞
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤:', channels.length);
            console.log('–ö–∞–Ω–∞–ª—ã:', channels);
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        function checkEnvironment() {
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(function() {
                if (typeof CSInterface !== 'undefined' && !csInterface) {
                    try {
                        csInterface = new CSInterface();
                        log('‚úÖ CSInterface —Å–æ–∑–¥–∞–Ω –≤ checkEnvironment', 'info');
                    } catch(e) {
                        log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è CSInterface: ' + e.message, 'error');
                    }
                }
                
                if (csInterface) {
                    log('‚úÖ CSInterface –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'info');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É evalScript
                    csInterface.evalScript('app.project ? "OK" : "NO_PROJECT"', function(result) {
                        if (result === 'OK') {
                            log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Premiere Pro —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'info');
                        } else if (result === 'NO_PROJECT') {
                            log('‚ö†Ô∏è Premiere Pro –ø–æ–¥–∫–ª—é—á–µ–Ω, –Ω–æ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞', 'warning');
                        } else {
                            log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Premiere Pro', 'error');
                        }
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é
                    csInterface.evalScript('app.version', function(version) {
                        if (version && version !== 'undefined') {
                            log(`Adobe Premiere Pro ${version}`, 'info');
                        }
                    });
                } else {
                    log('‚ùå CSInterface –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–∞–±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª—è—Ü–∏–∏', 'warning');
                }
            }, 200);
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    tab.classList.add('active');
                    const targetContent = document.getElementById(targetTab);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    } else {
                        console.error('–í–∫–ª–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', targetTab);
                    }
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –°–ª–∞–π–¥–µ—Ä—ã
            document.querySelectorAll('.slider').forEach(slider => {
                slider.addEventListener('input', function() {
                    const valueSpan = document.getElementById(this.id + 'Value');
                    if (valueSpan) {
                        let value = this.value;
                        if (this.id.includes('Angle')) {
                            value += '¬∞';
                        } else if (this.id !== 'renderThreads' && !this.id.includes('bezier')) {
                            value += '%';
                        }
                        valueSpan.textContent = value;
                    }
                });
            });

            // –ß–µ–∫–±–æ–∫—Å—ã —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
            document.getElementById('enableColorCorrection').addEventListener('change', function() {
                document.getElementById('colorCorrectionSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            document.getElementById('enableVignette').addEventListener('change', function() {
                document.getElementById('vignetteSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            document.getElementById('enableGrain').addEventListener('change', function() {
                document.getElementById('grainSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // 3D –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('enable3D').addEventListener('change', function() {
                document.getElementById('3dSettings').style.display = 
                    this.checked ? 'block' : 'none';
            });

            // –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è
            document.getElementById('easingType').addEventListener('change', function() {
                document.getElementById('bezierSettings').style.display = 
                    this.value === 'bezier' ? 'block' : 'none';
            });

            // –ß–∞—Å—Ç–æ—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            document.getElementById('effectFrequency').addEventListener('change', function() {
                document.getElementById('percentSettings').style.display = 'none';
                document.getElementById('everySettings').style.display = 'none';
                
                if (this.value === 'percent') {
                    document.getElementById('percentSettings').style.display = 'block';
                } else if (this.value === 'every') {
                    document.getElementById('everySettings').style.display = 'block';
                }
            });

            // –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ
            document.getElementById('channelResolution').addEventListener('change', function() {
                document.getElementById('customResolution').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type} slide-in`;
            
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }

        // === –†–ê–ë–û–¢–ê –° –ü–ê–ü–ö–û–ô –ü–†–û–ï–ö–¢–ê ===
        
        function selectProjectFolder() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            if (window.cep && window.cep.fs) {
                // CEP –æ–∫—Ä—É–∂–µ–Ω–∏–µ
                const result = window.cep.fs.showOpenDialogEx(false, true, "–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞", "");
                if (result.data && result.data.length > 0) {
                    PROJECT_FOLDER = result.data[0];
                    document.getElementById('projectPath').value = PROJECT_FOLDER;
                    
                    AUDIO_VARIANTS_FOLDER = PROJECT_FOLDER + "/audio_variants";
                    RENDERS_FOLDER = PROJECT_FOLDER + "/renders";
                    
                    createSubfolders();
                    scanProjectFolder();
                }
            } else {
                // –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º - —Å–∏–º—É–ª—è—Ü–∏—è
                const simulatedPath = prompt("–í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:", "C:/Projects/AutoMontage");
                if (simulatedPath) {
                    PROJECT_FOLDER = simulatedPath;
                    document.getElementById('projectPath').value = simulatedPath;
                    
                    AUDIO_VARIANTS_FOLDER = PROJECT_FOLDER + "/audio_variants";
                    RENDERS_FOLDER = PROJECT_FOLDER + "/renders";
                    
                    // –°–∏–º—É–ª—è—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                    updateProjectInfo({
                        images: 5,
                        videos: 3,
                        audio: 8,
                        pairs: 5
                    });
                    
                    window.lastScanResult = {
                        pairs: [
                            {number: '0001', mediaType: 'image', mediaFile: {name: '0001_image.jpg'}, audioFile: {name: '0001_audio.mp3'}},
                            {number: '0002', mediaType: 'image', mediaFile: {name: '0002_image.jpg'}, audioFile: {name: '0002_audio.mp3'}},
                            {number: '0003', mediaType: 'video', mediaFile: {name: '0003_video.mp4'}, audioFile: {name: '0003_audio.mp3'}},
                            {number: '0004', mediaType: 'image', mediaFile: {name: '0004_image.jpg'}, audioFile: {name: '0004_audio.mp3'}},
                            {number: '0005', mediaType: 'video', mediaFile: {name: '0005_video.mp4'}, audioFile: {name: '0005_audio.mp3'}}
                        ]
                    };
                    
                    log('–ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–±—Ä–∞–Ω–∞: ' + simulatedPath, 'info');
                }
            }
        }

        function createSubfolders() {
            if (!PROJECT_FOLDER) return;
            
            const extScript = `
                var audioVariantsDir = new Folder("${AUDIO_VARIANTS_FOLDER.replace(/\\/g, '\\\\')}");
                if (!audioVariantsDir.exists) audioVariantsDir.create();
                
                var rendersDir = new Folder("${RENDERS_FOLDER.replace(/\\/g, '\\\\')}");
                if (!rendersDir.exists) rendersDir.create();
                
                "–ü–æ–¥–ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã";
            `;
            
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    log('–ü–æ–¥–ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω—ã', 'info');
                });
            }
        }

        function scanProjectFolder() {
            if (!PROJECT_FOLDER) return;
            
            updateProgress(10, "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏...");
            console.log('–ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏:', PROJECT_FOLDER);
            
            const includeVideos = document.getElementById('includeVideos').checked;
            
            // –î–ª—è CEP –æ–∫—Ä—É–∂–µ–Ω–∏—è
            if (window.cep && window.cep.fs) {
                const folderPath = PROJECT_FOLDER;
                const result = window.cep.fs.readdir(folderPath);
                
                if (result.err === 0) {
                    const files = result.data;
                    console.log('–ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:', files.length);
                    
                    let images = 0, videos = 0, audio = 0;
                    const pairs = [];
                    const mediaFiles = {};
                    const audioFiles = {};
                    
                    files.forEach(fileName => {
                        const ext = fileName.substring(fileName.lastIndexOf('.')).toLowerCase();
                        const baseNumber = fileName.match(/^(\d{4})/);
                        
                        if (['.jpg', '.jpeg', '.png', '.tiff', '.bmp', '.tif'].includes(ext)) {
                            images++;
                            if (baseNumber) mediaFiles[baseNumber[1]] = {type: 'image', name: fileName};
                        } else if (includeVideos && ['.mp4', '.mov', '.avi', '.mkv'].includes(ext)) {
                            videos++;
                            if (baseNumber) mediaFiles[baseNumber[1]] = {type: 'video', name: fileName};
                        } else if (['.mp3', '.wav', '.aiff', '.m4a', '.flac'].includes(ext)) {
                            audio++;
                            if (baseNumber) audioFiles[baseNumber[1]] = fileName;
                        }
                    });
                    
                    // –°—á–∏—Ç–∞–µ–º –ø–∞—Ä—ã
                    Object.keys(mediaFiles).forEach(num => {
                        if (audioFiles[num]) {
                            pairs.push({
                                number: num,
                                mediaType: mediaFiles[num].type,
                                mediaFile: {name: mediaFiles[num].name},
                                audioFile: {name: audioFiles[num]}
                            });
                        }
                    });
                    
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –Ω–æ–º–µ—Ä—É
                    pairs.sort((a, b) => parseInt(a.number) - parseInt(b.number));
                    
                    const scanResult = {images, videos, audio, pairs};
                    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', scanResult);
                    
                    updateProgress(0, "–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
                    updateProjectInfo(scanResult);
                    window.lastScanResult = scanResult;
                    
                } else {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø–∞–ø–∫–∏:', result.err);
                    log('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø–∞–ø–∫–∏', 'error');
                }
                
            } else if (typeof CSInterface !== 'undefined') {
                // –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± —á–µ—Ä–µ–∑ ExtendScript
                const extScript = `
                    function scanFolder(folderPath, includeVideos) {
                        try {
                            var folder = new Folder(folderPath);
                            if (!folder.exists) {
                                return {images: 0, videos: 0, audio: 0, pairs: 0, error: "–ü–∞–ø–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"};
                            }
                            
                            var images = 0;
                            var videos = 0;
                            var audio = 0;
                            var pairs = [];
                            var mediaFiles = {};
                            var audioFiles = {};
                            
                            var files = folder.getFiles();
                            var supportedImageFormats = ['.jpg', '.jpeg', '.png', '.tiff', '.bmp', '.tif'];
                            var supportedVideoFormats = ['.mp4', '.mov', '.avi', '.mkv'];
                            var supportedAudioFormats = ['.mp3', '.wav', '.aiff', '.m4a', '.flac'];
                            
                            // –°–∫–∞–Ω–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã
                            for (var i = 0; i < files.length; i++) {
                                if (files[i] instanceof File) {
                                    var fileName = files[i].name;
                                    var ext = fileName.substr(fileName.lastIndexOf('.')).toLowerCase();
                                    var baseNumber = fileName.match(/^(\\d{4})/);
                                    
                                    if (supportedImageFormats.indexOf(ext) > -1) {
                                        images++;
                                        if (baseNumber) mediaFiles[baseNumber[1]] = {type: 'image', file: files[i]};
                                    } else if (includeVideos && supportedVideoFormats.indexOf(ext) > -1) {
                                        videos++;
                                        if (baseNumber) mediaFiles[baseNumber[1]] = {type: 'video', file: files[i]};
                                    } else if (supportedAudioFormats.indexOf(ext) > -1) {
                                        audio++;
                                        if (baseNumber) audioFiles[baseNumber[1]] = files[i];
                                    }
                                }
                            }
                            
                            // –°—á–∏—Ç–∞–µ–º –ø–∞—Ä—ã
                            for (var num in mediaFiles) {
                                if (audioFiles[num]) {
                                    pairs.push({
                                        number: num,
                                        mediaType: mediaFiles[num].type,
                                        mediaFile: mediaFiles[num].file,
                                        audioFile: audioFiles[num]
                                    });
                                }
                            }
                            
                            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –Ω–æ–º–µ—Ä—É
                            pairs.sort(function(a, b) {
                                return parseInt(a.number) - parseInt(b.number);
                            });
                            
                            return {
                                images: images,
                                videos: videos,
                                audio: audio,
                                pairs: pairs
                            };
                            
                        } catch(e) {
                            return {images: 0, videos: 0, audio: 0, pairs: 0, error: e.toString()};
                        }
                    }
                    
                    JSON.stringify(scanFolder("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}", ${includeVideos}));
                `;
                
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    try {
                        const scanResult = JSON.parse(result);
                        console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (ExtendScript):', scanResult);
                        updateProgress(0, "–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
                        updateProjectInfo(scanResult);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                        window.lastScanResult = scanResult;
                    } catch(e) {
                        log('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ' + e.message, 'error');
                    }
                });
            } else {
                // –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º - —Å–∏–º—É–ª—è—Ü–∏—è
                console.log('–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–º—É–ª—è—Ü–∏—é');
                updateProjectInfo({
                    images: 5,
                    videos: 3,
                    audio: 8,
                    pairs: 5
                });
                
                window.lastScanResult = {
                    pairs: [
                        {number: '0001', mediaType: 'image', mediaFile: {name: '0001_image.jpg'}, audioFile: {name: '0001_audio.mp3'}},
                        {number: '0002', mediaType: 'image', mediaFile: {name: '0002_image.jpg'}, audioFile: {name: '0002_audio.mp3'}},
                        {number: '0003', mediaType: 'video', mediaFile: {name: '0003_video.mp4'}, audioFile: {name: '0003_audio.mp3'}},
                        {number: '0004', mediaType: 'image', mediaFile: {name: '0004_image.jpg'}, audioFile: {name: '0004_audio.mp3'}},
                        {number: '0005', mediaType: 'video', mediaFile: {name: '0005_video.mp4'}, audioFile: {name: '0005_audio.mp3'}}
                    ]
                };
            }
        }

        function updateProjectInfo(scanResult) {
            let info = "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:\n\n";
            info += `‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${scanResult.images}\n`;
            if (scanResult.videos > 0) {
                info += `üé• –í–∏–¥–µ–æ: ${scanResult.videos}\n`;
            }
            info += `üéµ –ê—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤: ${scanResult.audio}\n`;
            info += `üìé –ì–æ—Ç–æ–≤—ã—Ö –ø–∞—Ä: ${scanResult.pairs ? scanResult.pairs.length : scanResult.pairs}`;
            
            if (scanResult.error) {
                info += `\n\n‚ö†Ô∏è –û—à–∏–±–∫–∞: ${scanResult.error}`;
            }
            
            document.getElementById('projectInfo').textContent = info;
            log(`–ù–∞–π–¥–µ–Ω–æ –ø–∞—Ä —Ñ–∞–π–ª–æ–≤: ${scanResult.pairs ? scanResult.pairs.length : scanResult.pairs}`, 'info');
        }

        // === –†–ê–ë–û–¢–ê –° –ö–ê–ù–ê–õ–ê–ú–ò ===

        function loadChannels() {
            const stored = localStorage.getItem('autoMontageChannels');
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏–∑ localStorage:', stored);
            
            if (stored) {
                try {
                    channels = JSON.parse(stored);
                    console.log('–ö–∞–Ω–∞–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', channels);
                } catch(e) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤:', e);
                    channels = getDefaultChannels();
                }
            } else {
                console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤, —Å–æ–∑–¥–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                channels = getDefaultChannels();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞–Ω–∞–ª—ã - —ç—Ç–æ –º–∞—Å—Å–∏–≤
            if (!Array.isArray(channels)) {
                console.error('–ö–∞–Ω–∞–ª—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', channels);
                channels = getDefaultChannels();
            }
            
            // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π, –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (channels.length === 0) {
                console.log('–ú–∞—Å—Å–∏–≤ –∫–∞–Ω–∞–ª–æ–≤ –ø—É—Å—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                channels = getDefaultChannels();
            }
            
            saveChannels(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
            updateChannelLists();
        }

        function getDefaultChannels() {
            try {
                return [
                    {
                        id: 'channel_' + Date.now(),
                        name: '–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª',
                        description: '–ì–ª–∞–≤–Ω—ã–π YouTube –∫–∞–Ω–∞–ª',
                        template: 'youtube',
                        export: {
                            resolution: '1920x1080',
                            customWidth: 1920,
                            customHeight: 1080,
                            fps: 30,
                            bitrate: 8,
                            codec: 'h264'
                        },
                        effects: {
                            // Ken Burns
                            kenBurns: ['zoomIn', 'panRight'],
                            kenBurnsIntensity: 30,
                            rotationAngle: 5,
                            smartCrop: true,
                            kbRandomize: false,
                            
                            // –ü–µ—Ä–µ—Ö–æ–¥—ã
                            transitions: ['fade', 'dissolve'],
                            transitionDuration: 1.0,
                            transRandomize: false,
                            
                            // –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
                            colorCorrection: true,
                            colorFilter: 'warm',
                            vignette: true,
                            vignetteIntensity: 40,
                            grain: false,
                            grainIntensity: 20,
                            
                            // –ê—É–¥–∏–æ
                            audioPitch: '-0.5',
                            audioEffect: 'bass',
                            audioStereoEnhance: true,
                            audioNormalize: true,
                            
                            // –ê–Ω–∏–º–∞—Ü–∏—è
                            easingType: 'ease',
                            bezierP1: 25,
                            bezierP2: 75,
                            
                            // 3D
                            enable3D: false,
                            type3D: 'basic',
                            intensity3D: 20,
                            autoRotate3D: false,
                            
                            // CapCut —ç—Ñ—Ñ–µ–∫—Ç—ã
                            capcutEffects: ['zoomBurst'],
                            scaleAmplitude: 15,
                            zoomBurstStart: 150,
                            zoomBurstDecay: 80,
                            motionEffects: [],
                            motionIntensity: 30,
                            effectFrequency: 'percent',
                            effectPercent: 30,
                            effectEvery: 3,
                            avoidRepetition: true
                        },
                        overlays: {
                            enabled: false,
                            files: [],
                            blendMode: 'screen',
                            opacity: 100,
                            randomize: false,
                            stretch: true
                        }
                    }
                ];
            } catch(e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:', e);
                return [];
            }
        }

        function saveChannels() {
            localStorage.setItem('autoMontageChannels', JSON.stringify(channels));
        }

        function updateChannelLists() {
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –∫–∞–Ω–∞–ª–æ–≤, –≤—Å–µ–≥–æ –∫–∞–Ω–∞–ª–æ–≤:', channels.length);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const channelList = document.getElementById('channelList');
            if (channelList) {
                channelList.innerHTML = '';
                
                channels.forEach(channel => {
                    const card = document.createElement('div');
                    card.className = 'channel-card';
                    card.innerHTML = `
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-info">${channel.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                        <div class="channel-info">${channel.export.resolution} ‚Ä¢ ${channel.export.fps}fps ‚Ä¢ ${channel.export.bitrate}Mbps</div>
                        <div class="channel-actions">
                            <button class="channel-action-btn" onclick="editChannel('${channel.id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                            <button class="channel-action-btn" onclick="duplicateChannel('${channel.id}')" title="–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                            <button class="channel-action-btn" onclick="deleteChannel('${channel.id}')" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        </div>
                    `;
                    channelList.appendChild(card);
                });
            } else {
                console.error('–≠–ª–µ–º–µ–Ω—Ç channelList –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            const genChannelList = document.getElementById('generationChannelList');
            if (genChannelList) {
                genChannelList.innerHTML = '';
                
                channels.forEach(channel => {
                    const card = document.createElement('div');
                    card.className = 'channel-card';
                    card.onclick = () => toggleChannelSelection(channel.id);
                    card.innerHTML = `
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-info">${channel.export.resolution} ‚Ä¢ ${channel.export.codec}</div>
                        <div class="tags-container">
                            ${channel.effects && channel.effects.kenBurns && channel.effects.kenBurns.length > 0 ? '<span class="tag">Ken Burns</span>' : ''}
                            ${channel.effects && channel.effects.capcutEffects && channel.effects.capcutEffects.length > 0 ? '<span class="tag">CapCut FX</span>' : ''}
                            ${channel.overlays && channel.overlays.enabled ? '<span class="tag">–û–≤–µ—Ä–ª–µ–∏</span>' : ''}
                            ${channel.effects && channel.effects.enable3D ? '<span class="tag">3D</span>' : ''}
                        </div>
                    `;
                    if (selectedChannels.has(channel.id)) {
                        card.classList.add('selected');
                    }
                    genChannelList.appendChild(card);
                });
            } else {
                console.error('–≠–ª–µ–º–µ–Ω—Ç generationChannelList –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            updateChannelSelectors();
        }

        function updateChannelSelectors() {
            const selectors = [
                'channelSelector',
                'overlayChannelSelector', 
                'capcutChannelSelector'
            ];
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                if (selector) {
                    const currentValue = selector.value;
                    selector.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>';
                    
                    channels.forEach(channel => {
                        const option = document.createElement('option');
                        option.value = channel.id;
                        option.textContent = channel.name;
                        selector.appendChild(option);
                    });
                    
                    selector.value = currentValue;
                }
            });
        }

        function toggleChannelSelection(channelId) {
            if (selectedChannels.has(channelId)) {
                selectedChannels.delete(channelId);
            } else {
                selectedChannels.add(channelId);
            }
            updateChannelLists();
        }

        function selectAllChannels() {
            channels.forEach(channel => selectedChannels.add(channel.id));
            updateChannelLists();
        }

        function deselectAllChannels() {
            selectedChannels.clear();
            updateChannelLists();
        }

        // === –°–û–ó–î–ê–ù–ò–ï –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ù–ê–õ–ê–ú–ò ===

        function createChannel() {
            document.getElementById('channelModal').classList.add('show');
        }

        function saveNewChannel() {
            const name = document.getElementById('newChannelName').value.trim();
            const description = document.getElementById('newChannelDescription').value.trim();
            const template = document.getElementById('newChannelTemplate').value;
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞!');
                return;
            }
            
            // –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —à–∞–±–ª–æ–Ω–∞
            const templateSettings = {
                youtube: { resolution: '1920x1080', fps: 30, bitrate: 8 },
                shorts: { resolution: '1080x1920', fps: 30, bitrate: 10 },
                square: { resolution: '1080x1080', fps: 30, bitrate: 6 },
                custom: { resolution: 'custom', fps: 30, bitrate: 8 }
            };
            
            const settings = templateSettings[template] || templateSettings.youtube;
            
            const newChannel = {
                id: 'channel_' + Date.now(),
                name: name,
                description: description,
                template: template,
                export: {
                    resolution: settings.resolution,
                    customWidth: 1920,
                    customHeight: 1080,
                    fps: settings.fps,
                    bitrate: settings.bitrate,
                    codec: 'h264'
                },
                effects: {
                    kenBurns: [],
                    kenBurnsIntensity: 30,
                    rotationAngle: 5,
                    smartCrop: true,
                    kbRandomize: false,
                    transitions: ['fade'],
                    transitionDuration: 1.0,
                    transRandomize: false,
                    colorCorrection: false,
                    colorFilter: 'none',
                    vignette: false,
                    vignetteIntensity: 40,
                    grain: false,
                    grainIntensity: 20,
                    audioPitch: '0',
                    audioEffect: 'none',
                    audioStereoEnhance: false,
                    audioNormalize: true,
                    easingType: 'ease',
                    bezierP1: 25,
                    bezierP2: 75,
                    enable3D: false,
                    type3D: 'basic',
                    intensity3D: 20,
                    autoRotate3D: false,
                    capcutEffects: [],
                    scaleAmplitude: 15,
                    zoomBurstStart: 150,
                    zoomBurstDecay: 80,
                    motionEffects: [],
                    motionIntensity: 30,
                    effectFrequency: 'all',
                    effectPercent: 50,
                    effectEvery: 3,
                    avoidRepetition: true
                },
                overlays: {
                    enabled: false,
                    files: [],
                    blendMode: 'screen',
                    opacity: 100,
                    randomize: false,
                    stretch: true
                }
            };
            
            channels.push(newChannel);
            saveChannels();
            updateChannelLists();
            closeModal('channelModal');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            document.getElementById('newChannelName').value = '';
            document.getElementById('newChannelDescription').value = '';
            document.getElementById('newChannelTemplate').value = 'youtube';
            
            log(`–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª: ${name}`, 'info');
        }

        function createChannelFromTemplate() {
            document.getElementById('templateModal').classList.add('show');
        }

        function createFromTemplate(templateType) {
            const templates = {
                dynamic: {
                    name: '–î–∏–Ω–∞–º–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª',
                    description: '–ú–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤',
                    kenBurns: ['zoomIn', 'zoomOut', 'panLeft', 'panRight', 'rotate'],
                    kenBurnsIntensity: 50,
                    transitions: ['zoom', 'slide', 'push'],
                    transitionDuration: 0.5,
                    capcutEffects: ['zoomBurst', 'bounce', 'shake'],
                    effectFrequency: 'percent',
                    effectPercent: 50
                },
                cinematic: {
                    name: '–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª',
                    description: '–ü–ª–∞–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞',
                    kenBurns: ['zoomIn', 'panRight'],
                    kenBurnsIntensity: 30,
                    transitions: ['fade', 'dissolve'],
                    transitionDuration: 2.0,
                    colorCorrection: true,
                    colorFilter: 'cinematic',
                    vignette: true,
                    vignetteIntensity: 60,
                    grain: true,
                    grainIntensity: 15
                },
                minimal: {
                    name: '–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª',
                    description: '–ü—Ä–æ—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –±–µ–∑ –ª–∏—à–Ω–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤',
                    kenBurns: [],
                    transitions: ['fade'],
                    transitionDuration: 1.0,
                    colorCorrection: false
                },
                retro: {
                    name: '–†–µ—Ç—Ä–æ –∫–∞–Ω–∞–ª',
                    description: '–í–∏–Ω—Ç–∞–∂–Ω—ã–π —Å—Ç–∏–ª—å —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ —Å—Ç–∞—Ä–æ–π –ø–ª–µ–Ω–∫–∏',
                    kenBurns: ['zoomOut', 'panLeft'],
                    kenBurnsIntensity: 20,
                    transitions: ['dip_black', 'dip_white'],
                    transitionDuration: 1.5,
                    colorCorrection: true,
                    colorFilter: 'vintage',
                    vignette: true,
                    vignetteIntensity: 80,
                    grain: true,
                    grainIntensity: 40,
                    audioPitch: '-1',
                    audioEffect: 'vintage'
                }
            };
            
            const template = templates[templateType];
            if (!template) return;
            
            const newChannel = {
                id: 'channel_' + Date.now(),
                name: template.name,
                description: template.description,
                template: 'youtube',
                export: {
                    resolution: '1920x1080',
                    customWidth: 1920,
                    customHeight: 1080,
                    fps: 30,
                    bitrate: 8,
                    codec: 'h264'
                },
                effects: {
                    kenBurns: template.kenBurns || [],
                    kenBurnsIntensity: template.kenBurnsIntensity || 30,
                    rotationAngle: 5,
                    smartCrop: true,
                    kbRandomize: false,
                    transitions: template.transitions || ['fade'],
                    transitionDuration: template.transitionDuration || 1.0,
                    transRandomize: false,
                    colorCorrection: template.colorCorrection || false,
                    colorFilter: template.colorFilter || 'none',
                    vignette: template.vignette || false,
                    vignetteIntensity: template.vignetteIntensity || 40,
                    grain: template.grain || false,
                    grainIntensity: template.grainIntensity || 20,
                    audioPitch: template.audioPitch || '0',
                    audioEffect: template.audioEffect || 'none',
                    audioStereoEnhance: false,
                    audioNormalize: true,
                    easingType: 'ease',
                    bezierP1: 25,
                    bezierP2: 75,
                    enable3D: false,
                    type3D: 'basic',
                    intensity3D: 20,
                    autoRotate3D: false,
                    capcutEffects: template.capcutEffects || [],
                    scaleAmplitude: 15,
                    zoomBurstStart: 150,
                    zoomBurstDecay: 80,
                    motionEffects: [],
                    motionIntensity: 30,
                    effectFrequency: template.effectFrequency || 'all',
                    effectPercent: template.effectPercent || 50,
                    effectEvery: 3,
                    avoidRepetition: true
                },
                overlays: {
                    enabled: false,
                    files: [],
                    blendMode: 'screen',
                    opacity: 100,
                    randomize: false,
                    stretch: true
                }
            };
            
            channels.push(newChannel);
            saveChannels();
            updateChannelLists();
            closeModal('templateModal');
            log(`–°–æ–∑–¥–∞–Ω –∫–∞–Ω–∞–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞: ${template.name}`, 'info');
        }

        function editChannel(channelId) {
            document.querySelector('[data-tab="effects"]').click();
            document.getElementById('channelSelector').value = channelId;
            loadChannelEffects();
        }

        function duplicateChannel(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            const newChannel = JSON.parse(JSON.stringify(channel));
            newChannel.id = 'channel_' + Date.now();
            newChannel.name = channel.name + ' (–∫–æ–ø–∏—è)';
            
            channels.push(newChannel);
            saveChannels();
            updateChannelLists();
            log(`–ö–∞–Ω–∞–ª "${channel.name}" –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω`, 'info');
        }

        function deleteChannel(channelId) {
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª "${channel.name}"?`)) {
                channels = channels.filter(c => c.id !== channelId);
                saveChannels();
                updateChannelLists();
                log(`–ö–∞–Ω–∞–ª "${channel.name}" —É–¥–∞–ª–µ–Ω`, 'info');
            }
        }

        function exportChannels() {
            const dataStr = JSON.stringify(channels, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'automontage_channels_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            
            log('–ö–∞–Ω–∞–ª—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'info');
        }

        function importChannels() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (Array.isArray(imported)) {
                            channels = channels.concat(imported);
                            saveChannels();
                            updateChannelLists();
                            log(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–Ω–∞–ª–æ–≤: ${imported.length}`, 'info');
                        } else {
                            alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                    } catch (err) {
                        alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + err.message);
                        log('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–∞–Ω–∞–ª–æ–≤', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // === –ì–ï–ù–ï–†–ê–¶–ò–Ø –ú–û–ù–¢–ê–ñ–ê ===

        function testMontage() {
            if (!PROJECT_FOLDER) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞!");
                return;
            }
            
            log('–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (1 –ø–∞—Ä–∞ —Ñ–∞–π–ª–æ–≤)', 'info');
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –¥–ª—è —Ç–µ—Å—Ç–∞
            const testChannel = {
                id: 'test_channel',
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –∫–∞–Ω–∞–ª',
                export: {
                    resolution: '1920x1080',
                    fps: 30,
                    bitrate: 8,
                    codec: 'h264'
                },
                effects: {
                    kenBurns: ['zoomIn'],
                    kenBurnsIntensity: 30,
                    transitions: ['fade'],
                    transitionDuration: 1.0,
                    audioPitch: '0',
                    audioEffect: 'none',
                    audioNormalize: true
                }
            };
            
            selectedChannels.clear();
            selectedChannels.add('test_channel');
            
            generateMontage(true);
        }

        function importFiles() {
            if (!PROJECT_FOLDER) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞!");
                return;
            }
            
            updateProgress(0, "–ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤...");
            log("–ù–∞—á–∏–Ω–∞–µ–º –∏–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç", 'info');
            
            const includeVideos = document.getElementById('includeVideos').checked;
            
            const extScript = `
                function importProjectFiles(folderPath, includeVideos) {
                    try {
                        var project = app.project;
                        if (!project) return "ERROR: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞";
                        
                        var folder = new Folder(folderPath);
                        if (!folder.exists) return "ERROR: –ü–∞–ø–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç";
                        
                        var importBin = project.rootItem.createBin("Auto Montage Import " + new Date().toLocaleString());
                        var files = folder.getFiles();
                        var importedCount = 0;
                        
                        var supportedImageFormats = ['.jpg', '.jpeg', '.png', '.tiff', '.bmp'];
                        var supportedVideoFormats = ['.mp4', '.mov', '.avi', '.mkv'];
                        var supportedAudioFormats = ['.mp3', '.wav', '.aiff', '.m4a', '.flac'];
                        
                        var filesToImport = [];
                        
                        for (var i = 0; i < files.length; i++) {
                            if (files[i] instanceof File) {
                                var ext = files[i].name.substr(files[i].name.lastIndexOf('.')).toLowerCase();
                                
                                if (supportedImageFormats.indexOf(ext) > -1 || 
                                    supportedAudioFormats.indexOf(ext) > -1 ||
                                    (includeVideos && supportedVideoFormats.indexOf(ext) > -1)) {
                                    filesToImport.push(files[i].fsName);
                                    importedCount++;
                                }
                            }
                        }
                        
                        if (filesToImport.length > 0) {
                            project.importFiles(filesToImport, false, importBin, false);
                        }
                        
                        return "SUCCESS: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ " + importedCount + " —Ñ–∞–π–ª–æ–≤";
                        
                    } catch(e) {
                        return "ERROR: " + e.toString();
                    }
                }
                
                importProjectFiles("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}", ${includeVideos});
            `;
            
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    if (result.indexOf("SUCCESS") === 0) {
                        updateProgress(100, "–§–∞–π–ª—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã");
                        log(result, 'info');
                    } else {
                        updateProgress(0, "–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞");
                        log(result, 'error');
                    }
                });
            } else {
                setTimeout(() => {
                    updateProgress(100, "–§–∞–π–ª—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (—Å–∏–º—É–ª—è—Ü–∏—è)");
                    log("–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 15 —Ñ–∞–π–ª–æ–≤ (—Å–∏–º—É–ª—è—Ü–∏—è)", 'info');
                }, 1500);
            }
        }

        async function generateMontage(testMode = false) {
            if (!PROJECT_FOLDER) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞!");
                return;
            }
            
            if (!testMode && selectedChannels.size === 0) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            if (!window.lastScanResult || !window.lastScanResult.pairs || window.lastScanResult.pairs.length === 0) {
                alert("–ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–∞—Ä —Ñ–∞–π–ª–æ–≤ –¥–ª—è –º–æ–Ω—Ç–∞–∂–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω—É–º–µ—Ä–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤ (0001, 0002...)");
                return;
            }
            
            isGenerating = true;
            generationAborted = false;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('cancelButton').classList.add('show');
            
            const channelsToProcess = testMode ? 
                [{id: 'test_channel', name: '–¢–µ—Å—Ç', export: {resolution: '1920x1080', fps: 30, bitrate: 8, codec: 'h264'}, effects: {}}] : 
                Array.from(selectedChannels).map(id => channels.find(c => c.id === id)).filter(Boolean);
            
            log(`–ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è ${channelsToProcess.length} –∫–∞–Ω–∞–ª–æ–≤`, 'info');
            
            // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç –µ—Å–ª–∏ –µ—Å—Ç—å CSInterface
            if (csInterface) {
                log('–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π...', 'info');
                await importFilesBeforeGeneration();
            }
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (document.getElementById('processAudioFirst').checked) {
                await prepareAudioFiles(channelsToProcess);
                
                if (generationAborted) {
                    finishGeneration();
                    return;
                }
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
            let channelIndex = 0;
            for (const channel of channelsToProcess) {
                if (generationAborted) break;
                
                channelIndex++;
                updateProgress(
                    (channelIndex / channelsToProcess.length) * 100,
                    `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–Ω–∞–ª–∞: ${channel.name}`
                );
                
                await generateChannelMontage(channel, testMode);
            }
            
            finishGeneration();
        }

        function finishGeneration() {
            isGenerating = false;
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('cancelButton').classList.remove('show');
            updateProgress(100, generationAborted ? "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞" : "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!");
            log(generationAborted ? "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º" : "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ", 
                generationAborted ? 'warning' : 'info');
        }

        async function importFilesBeforeGeneration() {
            return new Promise((resolve) => {
                const includeVideos = document.getElementById('includeVideos').checked;
                
                const extScript = `
                    function importProjectFiles(folderPath, audioVariantsPath, includeVideos) {
                        try {
                            var project = app.project;
                            if (!project) return "ERROR: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞";
                            
                            var importBin = project.rootItem.createBin("Auto Montage Import " + new Date().toLocaleString());
                            var importedCount = 0;
                            
                            var supportedImageFormats = ['.jpg', '.jpeg', '.png', '.tiff', '.bmp'];
                            var supportedVideoFormats = ['.mp4', '.mov', '.avi', '.mkv'];
                            var supportedAudioFormats = ['.mp3', '.wav', '.aiff', '.m4a', '.flac'];
                            
                            var filesToImport = [];
                            
                            // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–ø–∫–∏
                            var folder = new Folder(folderPath);
                            if (folder.exists) {
                                var files = folder.getFiles();
                                for (var i = 0; i < files.length; i++) {
                                    if (files[i] instanceof File) {
                                        var ext = files[i].name.substr(files[i].name.lastIndexOf('.')).toLowerCase();
                                        
                                        if (supportedImageFormats.indexOf(ext) > -1 || 
                                            supportedAudioFormats.indexOf(ext) > -1 ||
                                            (includeVideos && supportedVideoFormats.indexOf(ext) > -1)) {
                                            filesToImport.push(files[i].fsName);
                                        }
                                    }
                                }
                            }
                            
                            // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ –ø–∞–ø–∫–∏ audio_variants
                            var audioVariantsFolder = new Folder(audioVariantsPath);
                            if (audioVariantsFolder.exists) {
                                var audioFiles = audioVariantsFolder.getFiles();
                                for (var j = 0; j < audioFiles.length; j++) {
                                    if (audioFiles[j] instanceof File) {
                                        var ext2 = audioFiles[j].name.substr(audioFiles[j].name.lastIndexOf('.')).toLowerCase();
                                        if (supportedAudioFormats.indexOf(ext2) > -1) {
                                            filesToImport.push(audioFiles[j].fsName);
                                        }
                                    }
                                }
                            }
                            
                            if (filesToImport.length > 0) {
                                project.importFiles(filesToImport, false, importBin, false);
                                importedCount = filesToImport.length;
                            }
                            
                            return "SUCCESS: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ " + importedCount + " —Ñ–∞–π–ª–æ–≤";
                            
                        } catch(e) {
                            return "ERROR: " + e.toString();
                        }
                    }
                    
                    importProjectFiles("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}", "${AUDIO_VARIANTS_FOLDER.replace(/\\/g, '\\\\')}", ${includeVideos});
                `;
                
                csInterface.evalScript(extScript, function(result) {
                    log(result, result.indexOf("SUCCESS") === 0 ? 'info' : 'error');
                    setTimeout(resolve, 1000); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–º–ø–æ—Ä—Ç–∞
                });
            });
        }

        async function prepareAudioFiles(channelsToProcess) {
            return new Promise((resolve) => {
                updateProgress(10, "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤...");
                
                // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ
                const audioVariants = new Set();
                channelsToProcess.forEach(channel => {
                    const pitch = channel.effects.audioPitch || '0';
                    const effect = channel.effects.audioEffect || 'none';
                    audioVariants.add(`${pitch}_${effect}`);
                });
                
                log(`–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å ${audioVariants.size} –∞—É–¥–∏–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤`, 'info');
                
                const transcodeRussian = document.getElementById('transcodeRussian').checked;
                
                const extScript = `
                    function prepareAudioVariants(folderPath, variants, transcodeRussian) {
                        try {
                            var variantsFolder = new Folder(folderPath + "/audio_variants");
                            if (!variantsFolder.exists) variantsFolder.create();
                            
                            // –°–æ–∑–¥–∞–µ–º bat —Ñ–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                            var batContent = '@echo off\\n';
                            batContent += 'echo Starting audio processing...\\n';
                            batContent += 'cd /d "' + folderPath + '"\\n';
                            
                            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã
                            var folder = new Folder(folderPath);
                            var audioFiles = [];
                            var files = folder.getFiles();
                            
                            for (var i = 0; i < files.length; i++) {
                                if (files[i] instanceof File) {
                                    var ext = files[i].name.substr(files[i].name.lastIndexOf('.')).toLowerCase();
                                    if (['.mp3', '.wav', '.m4a', '.flac'].indexOf(ext) > -1) {
                                        audioFiles.push(files[i]);
                                    }
                                }
                            }
                            
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                            for (var j = 0; j < audioFiles.length; j++) {
                                var audioFile = audioFiles[j];
                                var baseName = audioFile.name.substr(0, audioFile.name.lastIndexOf('.'));
                                
                                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä—É—Å—Å–∫–∏—Ö –∏–º–µ–Ω –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                                var inputName = audioFile.name;
                                var outputBaseName = baseName;
                                
                                if (transcodeRussian && /[–∞-—è–ê-–Ø]/.test(inputName)) {
                                    // –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞
                                    var number = baseName.match(/^\\d+/);
                                    outputBaseName = number ? 'audio_' + number[0] : 'audio_' + j;
                                }
                                
                                for (var k = 0; k < variants.length; k++) {
                                    var parts = variants[k].split('_');
                                    var pitch = parts[0];
                                    var effect = parts[1];
                                    
                                    var outputName = outputBaseName + '_pitch_' + pitch.replace('+', 'plus').replace('.', '_');
                                    if (effect !== 'none') outputName += '_' + effect;
                                    outputName += '.mp3';
                                    
                                    // FFmpeg –∫–æ–º–∞–Ω–¥–∞
                                    batContent += 'ffmpeg -i "' + inputName + '" ';
                                    
                                    // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                                    var filters = [];
                                    
                                    // Pitch
                                    if (pitch !== '0') {
                                        var semitones = parseFloat(pitch);
                                        var rate = Math.pow(2, semitones/12);
                                        filters.push('asetrate=44100*' + rate.toFixed(4) + ',aresample=44100');
                                    }
                                    
                                    // –≠—Ñ—Ñ–µ–∫—Ç—ã
                                    if (effect === 'bass') {
                                        filters.push('bass=g=10');
                                    } else if (effect === 'reverb') {
                                        filters.push('aecho=0.8:0.9:40:0.4');
                                    } else if (effect === 'echo') {
                                        filters.push('aecho=0.8:0.7:60:0.5');
                                    }
                                    
                                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                                    if (filters.length > 0) {
                                        batContent += '-af "' + filters.join(',') + '" ';
                                    }
                                    
                                    batContent += '-b:a 192k "audio_variants/' + outputName + '" -y\\n';
                                }
                            }
                            
                            batContent += 'echo Audio processing completed\\n';
                            batContent += 'pause\\n';
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º bat —Ñ–∞–π–ª
                            var batFile = new File(folderPath + '/process_audio.bat');
                            batFile.open('w');
                            batFile.write(batContent);
                            batFile.close();
                            
                            // –ó–∞–ø—É—Å–∫–∞–µ–º
                            batFile.execute();
                            
                            return "SUCCESS: Bat —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø—É—â–µ–Ω";
                            
                        } catch(e) {
                            return "ERROR: " + e.toString();
                        }
                    }
                    
                    var variants = ${JSON.stringify(Array.from(audioVariants))};
                    prepareAudioVariants("${PROJECT_FOLDER.replace(/\\/g, '\\\\')}", variants, ${transcodeRussian});
                `;
                
                if (typeof CSInterface !== 'undefined') {
                    const csInterface = new CSInterface();
                    csInterface.evalScript(extScript, function(result) {
                        log(result, result.startsWith('SUCCESS') ? 'info' : 'error');
                        
                        // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                        setTimeout(resolve, 3000);
                    });
                } else {
                    setTimeout(() => {
                        log("–ê—É–¥–∏–æ —Ñ–∞–π–ª—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã (—Å–∏–º—É–ª—è—Ü–∏—è)", 'info');
                        resolve();
                    }, 2000);
                }
            });
        }

        async function generateChannelMontage(channel, testMode = false) {
            return new Promise((resolve) => {
                log(`–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω—Ç–∞–∂–∞ –¥–ª—è –∫–∞–Ω–∞–ª–∞: ${channel.name}`, 'info');
                
                const pairs = testMode ? 
                    window.lastScanResult.pairs.slice(0, 1) : // –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –ø–∞—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∞
                    window.lastScanResult.pairs;
                
                const config = {
                    channelName: channel.name.replace(/[^a-zA-Z0-9]/g, '_'), // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è
                    channelId: channel.id,
                    export: channel.export,
                    effects: channel.effects,
                    overlays: channel.overlays,
                    projectFolder: PROJECT_FOLDER,
                    audioVariantsFolder: AUDIO_VARIANTS_FOLDER,
                    pairs: pairs,
                    testMode: testMode
                };
                
                if (csInterface) {
                    log('üîß –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω—Ç–∞–∂–∞ —á–µ—Ä–µ–∑ ExtendScript', 'info');
                    
                    const extScript = `
                        ${getMontageFunctions()}
                        
                        try {
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
                            if (!app.project) {
                                throw new Error("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Premiere Pro");
                            }
                            
                            var config = ${JSON.stringify(config)};
                            var result = createChannelMontage(config);
                            JSON.stringify(result);
                        } catch(e) {
                            JSON.stringify({success: false, error: e.toString()});
                        }
                    `;
                    
                    csInterface.evalScript(extScript, function(result) {
                        log('üìã –û—Ç–≤–µ—Ç –æ—Ç ExtendScript: ' + (result ? result.substring(0, 100) : '–ø—É—Å—Ç–æ'), 'info');
                        
                        try {
                            const response = JSON.parse(result);
                            if (response.success) {
                                log(`‚úÖ –ú–æ–Ω—Ç–∞–∂ –¥–ª—è –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!`, 'info');
                                log(`–°–æ–∑–¥–∞–Ω–∞ —Å–µ–∫–≤–µ–Ω—Ü–∏—è: ${response.sequenceName}`, 'info');
                                log(`–î–æ–±–∞–≤–ª–µ–Ω–æ –∫–ª–∏–ø–æ–≤: ${response.clipsAdded}`, 'info');
                            } else {
                                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–Ω—Ç–∞–∂–∞: ${response.error}`, 'error');
                            }
                        } catch(e) {
                            log('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: ' + e.message, 'error');
                            log('–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç: ' + result, 'error');
                        }
                        resolve();
                    });
                } else {
                    log('‚ö†Ô∏è CSInterface –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∂–∏–º —Å–∏–º—É–ª—è—Ü–∏–∏', 'warning');
                    setTimeout(() => {
                        log(`–ú–æ–Ω—Ç–∞–∂ –¥–ª—è –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ–∑–¥–∞–Ω (—Å–∏–º—É–ª—è—Ü–∏—è)`, 'info');
                        resolve();
                    }, 3000);
                }
            });
        }

        function getMontageFunctions() {
            return `
                function createChannelMontage(config) {
                    var project = app.project;
                    if (!project) {
                        return {success: false, error: "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞"};
                    }
                    
                    try {
<<<<<<< HEAD
											
=======
>>>>>>> 5adb8a335390beae31960bdd51844c4147e887e1
                        // –°–æ–∑–¥–∞–µ–º —Å–µ–∫–≤–µ–Ω—Ü–∏—é
                        var sequenceName = "Montage_" + config.channelName + "_" + new Date().getTime();
                        
                        // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–µ—Å–µ—Ç
                        var presetPath = getSequencePreset(config.export);
                        var sequence = project.createNewSequence(sequenceName, presetPath);
                        
                        if (!sequence) {
                            return {success: false, error: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–µ–∫–≤–µ–Ω—Ü–∏—é"};
                        }
                        
                        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–Ω—Ç–∞–∂–∞
                        var result = buildMontageSequence(sequence, config);
                        
                        if (!result.success) {
                            return result;
                        }
                        
                        return {
                            success: true, 
                            sequenceName: sequenceName,
                            clipsAdded: result.clipsAdded
                        };
                        
                    } catch(e) {
                        return {success: false, error: "createChannelMontage: " + e.toString()};
                    }
                }
                
                function getSequencePreset(exportSettings) {
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º ID –ø—Ä–µ—Å–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    if (exportSettings.resolution === '1920x1080') {
                        return ""; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π HD –ø—Ä–µ—Å–µ—Ç
                    } else if (exportSettings.resolution === '3840x2160') {
                        return ""; // 4K –ø—Ä–µ—Å–µ—Ç
                    } else if (exportSettings.resolution === '1080x1920') {
                        return ""; // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–µ—Å–µ—Ç
                    }
                    return ""; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
                }
                
<<<<<<< HEAD
				function buildMontageSequence(sequence, config) {
					try {
						alert("Effects: " + (config.effects ? "–µ—Å—Ç—å" : "–Ω–µ—Ç") + 
                              ", kenBurns: " + (config.effects && config.effects.kenBurns ? config.effects.kenBurns.length : "0"));
						$.writeln("=== –ù–ê–ß–ê–õ–û buildMontageSequence ===");
						
						var videoTrack1 = sequence.videoTracks[0];
						var audioTrack1 = sequence.audioTracks[0];
						
						if (!videoTrack1 || !audioTrack1) {
							return {success: false, error: "–ù–µ—Ç —Ç—Ä–µ–∫–æ–≤"};
						$.writeln("=== –û–¢–õ–ê–î–ö–ê –ù–ê–°–¢–†–û–ï–ö ===");
						try {
							$.writeln("config –ø–µ—Ä–µ–¥–∞–Ω: " + (config ? "–î–ê" : "–ù–ï–¢"));
							if (config) {
								$.writeln("config.effects: " + (config.effects ? "–ï–°–¢–¨" : "–ù–ï–¢"));
								if (config.effects) {
									$.writeln("kenBurns –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: " + (config.effects.kenBurns ? config.effects.kenBurns.length + " —ç—Ñ—Ñ–µ–∫—Ç–æ–≤" : "–ù–ï–¢"));
									$.writeln("transitions –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: " + (config.effects.transitions ? config.effects.transitions.length + " –ø–µ—Ä–µ—Ö–æ–¥–æ–≤" : "–ù–ï–¢"));
									$.writeln("colorCorrection: " + config.effects.colorCorrection);
								}
							}
						} catch(e) {
							$.writeln("–û—à–∏–±–∫–∞ –æ—Ç–ª–∞–¥–∫–∏: " + e.toString());
						}
						$.writeln("=========================");
						if (config.effects) {
							$.writeln("config.effects —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
							$.writeln("kenBurns: " + JSON.stringify(config.effects.kenBurns));
							$.writeln("transitions: " + JSON.stringify(config.effects.transitions));
						} else {
							$.writeln("config.effects –û–¢–°–£–¢–°–¢–í–£–ï–¢!");
						}
						$.writeln("=========================");							
						}
						
						$.writeln("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä: " + config.pairs.length);
						
						var currentTime = 0;
						var clipsAdded = 0;
						var previousVideoClip = null;
						
						for (var i = 0; i < config.pairs.length; i++) {
							var pair = config.pairs[i];
							$.writeln("=== –ü–∞—Ä–∞ " + (i+1) + " ===");
							
							var mediaItem = findProjectItem(pair.mediaFile.name);
							var audioItem = findProjectItem(pair.audioFile.name);
							
							if (!mediaItem || !audioItem) {
								$.writeln("–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");
								continue;
							}
							
							$.writeln("–î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∏–ø—ã –≤ –ø–æ–∑–∏—Ü–∏—é: " + currentTime);
							
							// –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –ø–µ—Ä–≤—ã–º
							audioTrack1.insertClip(audioItem, currentTime);
							var audioClip = audioTrack1.clips[audioTrack1.clips.numItems - 1];
							
							if (!audioClip) {
								$.writeln("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏–æ –∫–ª–∏–ø");
								continue;
							}
							
							var audioDuration = audioClip.duration.seconds;
							$.writeln("–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ: " + audioDuration);
							
							// –ù–û–í–´–ô –ü–û–î–•–û–î: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º In/Out —Ç–æ—á–∫–∏ –ü–ï–†–ï–î –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤–∏–¥–µ–æ
							try {
								// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º In/Out —Ç–æ—á–∫–∏ –ü–ï–†–ï–î –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
								mediaItem.setInPoint(0, 4);
								mediaItem.setOutPoint(audioDuration, 4);
								
								// –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏
								videoTrack1.insertClip(mediaItem, currentTime);
								var videoClip = videoTrack1.clips[videoTrack1.clips.numItems - 1];
								
								if (videoClip) {
									$.writeln("–í–∏–¥–µ–æ –∫–ª–∏–ø –¥–æ–±–∞–≤–ª–µ–Ω —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é: " + videoClip.duration.seconds);
									
									// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –º–∞—Å—à—Ç–∞–± –µ—Å–ª–∏ –æ–Ω –Ω—É–ª–µ–≤–æ–π
									try {
										for (var c = 0; c < videoClip.components.numItems; c++) {
											if (videoClip.components[c].displayName === "Motion") {
												var scaleParam = videoClip.components[c].properties[0];
												if (scaleParam && scaleParam.getValue() === 0) {
													scaleParam.setValue(100);
													$.writeln("–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω—É–ª–µ–≤–æ–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –∫–ª–∏–ø–∞ " + (i+1));
												}
												break;
											}
										}
									} catch(e) {
										$.writeln("–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∞: " + e.toString());
									}
									
									// –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–ª–∏–ø
									if (previousVideoClip && config.effects && config.effects.transitions && config.effects.transitions.length > 0) {
										try {
											addTransition(previousVideoClip, videoClip, config.effects);
											$.writeln("–ü–µ—Ä–µ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –º–µ–∂–¥—É –∫–ª–∏–ø–∞–º–∏ " + i + " –∏ " + (i+1));
										} catch(e) {
											$.writeln("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞: " + e.toString());
										}
									}
									
									previousVideoClip = videoClip;
								
								
							} else {
								$.writeln("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ –∫–ª–∏–ø");
							}
								
							} catch(e) {
								$.writeln("–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ In/Out: " + e.toString());
								
								// Fallback - –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
								// videoTrack1.insertClip(mediaItem, currentTime);
								var fallbackVideoClip = videoTrack1.clips[videoTrack1.clips.numItems - 1];
								
								if (fallbackVideoClip) {
									$.writeln("–î–æ–±–∞–≤–ª–µ–Ω –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏");
									
									// –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∫ fallback –∫–ª–∏–ø—É
									try {
										if (config.effects) {
											applyClipEffects(fallbackVideoClip, config.effects, i);
											$.writeln("–≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ fallback –∫–ª–∏–ø—É " + (i+1));
										}
									} catch(e) {
										$.writeln("–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫ fallback: " + e.toString());
									}
									
									// –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥
									if (previousVideoClip && config.effects && config.effects.transitions && config.effects.transitions.length > 0) {
										try {
											addTransition(previousVideoClip, fallbackVideoClip, config.effects);
											$.writeln("–ü–µ—Ä–µ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è fallback –∫–ª–∏–ø–∞");
										} catch(e) {
											$.writeln("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–ª—è fallback: " + e.toString());
										}
									}
									
									previousVideoClip = fallbackVideoClip;
								}
							}
							
							currentTime += audioDuration;
							clipsAdded += 2;
							
							$.writeln("–ü–∞—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞. –°–ª–µ–¥—É—é—â–∞—è –ø–æ–∑–∏—Ü–∏—è: " + currentTime);
						}
						
						// –î–æ–±–∞–≤–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–∏ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
						if (config.overlays && config.overlays.enabled && config.overlays.files && config.overlays.files.length > 0) {
							try {
								$.writeln("–î–æ–±–∞–≤–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–∏...");
								addOverlays(sequence, config.overlays, currentTime);
								$.writeln("–û–≤–µ—Ä–ª–µ–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã");
							} catch(e) {
								$.writeln("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–≤–µ—Ä–ª–µ–µ–≤: " + e.toString());
							}
						}
						
						$.writeln("–ò–¢–û–ì–û: " + clipsAdded + " –∫–ª–∏–ø–æ–≤");
						$.writeln("=== –ö–û–ù–ï–¶ buildMontageSequence ===");
						
						return {success: true, clipsAdded: clipsAdded, totalDuration: currentTime};
						
					} catch(e) {
						$.writeln("–û–®–ò–ë–ö–ê: " + e.toString());
						return {success: false, error: e.toString()};
					}
				}                
=======
                function buildMontageSequence(sequence, config) {
                    try {
                        var videoTrack = sequence.videoTracks[0];
                        var audioTrack = sequence.audioTracks[0];
                        
                        if (!videoTrack || !audioTrack) {
                            return {success: false, error: "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç—Ä–µ–∫–∞–º"};
                        }
                        
                        var currentTime = 0;
                        var clipsAdded = 0;
                        var previousClip = null;
                        
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –ø–∞—Ä—É —Ñ–∞–π–ª–æ–≤
                        for (var i = 0; i < config.pairs.length; i++) {
                            var pair = config.pairs[i];
                            
                            // –ù–∞—Ö–æ–¥–∏–º –º–µ–¥–∏–∞ —Ñ–∞–π–ª –≤ –ø—Ä–æ–µ–∫—Ç–µ
                            var mediaItem = findProjectItem(pair.mediaFile.name);
                            var audioItem = findAudioVariant(pair.audioFile.name, config);
                            
                            if (!mediaItem || !audioItem) {
                                $.writeln("–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—É " + pair.number + ": —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ");
                                continue;
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Ç–∞–π–º–ª–∞–π–Ω
                            var videoClip = videoTrack.insertClip(mediaItem, currentTime);
                            var audioClip = audioTrack.insertClip(audioItem, currentTime);
                            
                            if (!videoClip || !audioClip) {
                                continue;
                            }
                            
                            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                            var audioDuration = audioClip.duration.seconds;
                            
                            // –î–ª—è –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
                            if (pair.mediaType === 'video' && videoClip.duration.seconds < audioDuration) {
                                handleVideoLooping(videoClip, audioDuration, videoTrack, currentTime);
                            } else {
                                // –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ - –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                                videoClip.end = videoClip.start + audioDuration;
                            }
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
                            applyClipEffects(videoClip, config, i);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–ª–∏–ø
                            if (previousClip && config.effects.transitions && config.effects.transitions.length > 0) {
                                addTransition(previousClip, videoClip, config.effects);
                            }
                            
                            previousClip = videoClip;
                            currentTime += audioDuration;
                            clipsAdded++;
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                        if (config.overlays && config.overlays.enabled && config.overlays.files.length > 0) {
                            addOverlays(sequence, config.overlays, currentTime);
                        }
                        
                        return {success: true, clipsAdded: clipsAdded};
                        
                    } catch(e) {
                        return {success: false, error: "buildMontageSequence: " + e.toString()};
                    }
                }
                
>>>>>>> 5adb8a335390beae31960bdd51844c4147e887e1
                function findProjectItem(fileName) {
                    // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ
                    function searchInBin(bin, name) {
                        for (var i = 0; i < bin.children.numItems; i++) {
                            var item = bin.children[i];
                            if (item.type === ProjectItemType.BIN) {
                                var found = searchInBin(item, name);
                                if (found) return found;
                            } else if (item.name === name) {
                                return item;
                            }
                        }
                        return null;
                    }
                    
                    return searchInBin(app.project.rootItem, fileName);
                }
                
                function findAudioVariant(originalName, config) {
                    // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                    var baseName = originalName.substr(0, originalName.lastIndexOf('.'));
                    var pitch = config.effects.audioPitch || '0';
                    var effect = config.effects.audioEffect || 'none';
                    
                    var variantName = baseName + '_pitch_' + pitch.replace('+', 'plus').replace('.', '_');
                    if (effect !== 'none') variantName += '_' + effect;
                    variantName += '.mp3';
                    
                    var variant = findProjectItem(variantName);
                    if (variant) return variant;
                    
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
                    return findProjectItem(originalName);
                }
                
                function handleVideoLooping(videoClip, targetDuration, videoTrack, startTime) {
                    var clipDuration = videoClip.duration.seconds;
                    var currentTime = startTime;
                    var sourceItem = videoClip.projectItem;
<<<<<<< HEAD
						// –°–±—Ä–∞—Å—ã–≤–∞–µ–º In/Out –¥–ª—è –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è
						try {
							sourceItem.clearInPoint();
							sourceItem.clearOutPoint();
						} catch(e) {}					
=======
>>>>>>> 5adb8a335390beae31960bdd51844c4147e887e1
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–ø–∞
                    videoClip.end = videoClip.start + Math.min(clipDuration, targetDuration);
                    currentTime += clipDuration;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ø–∏–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –Ω—É–∂–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    while (currentTime < startTime + targetDuration) {
                        var remainingTime = (startTime + targetDuration) - currentTime;
                        var nextClip = videoTrack.insertClip(sourceItem, currentTime);
                        
                        if (nextClip) {
                            if (remainingTime < clipDuration) {
                                // –û–±—Ä–µ–∑–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª–∏–ø
                                nextClip.end = nextClip.start + remainingTime;
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
                            var transition = videoTrack.getTransitionByName("Cross Dissolve");
                            if (transition) {
                                var transitionDuration = 0.5; // 0.5 —Å–µ–∫—É–Ω–¥—ã
                                videoTrack.insertTransition(transition, currentTime - transitionDuration/2);
                            }
                            
                            currentTime += Math.min(clipDuration, remainingTime);
                        } else {
                            break;
                        }
                    }
                }
                
<<<<<<< HEAD
				function applyClipEffects(clip, effects, clipIndex) {
					try {
						$.writeln("=== –ù–ê–ß–ê–õ–û applyClipEffects –¥–ª—è –∫–ª–∏–ø–∞ " + (clipIndex + 1) + " ===");
						
						if (!clip) {
							$.writeln("–ö–ª–∏–ø –Ω–µ –Ω–∞–π–¥–µ–Ω");
							return;
						}
						
						// –ü—Ä–∏–º–µ–Ω—è–µ–º Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Motion)
						if (effects.kenBurns && effects.kenBurns.length > 0) {
							applyKenBurnsEffect(clip, effects, clipIndex);
						}
						
						// –ü—Ä–∏–º–µ–Ω—è–µ–º CapCut —ç—Ñ—Ñ–µ–∫—Ç—ã (–µ—Å–ª–∏ –æ–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
						if (effects.capcutEffects && effects.capcutEffects.length > 0) {
							applyCapcutEffects(clip, effects, clipIndex);
						}
						
						// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é —á–µ—Ä–µ–∑ QE API
						if (effects.colorCorrection) {
							applyColorCorrectionQE(clip, effects);
						}
						
						$.writeln("=== –ö–û–ù–ï–¶ applyClipEffects ===");
						
					} catch(e) {
						$.writeln("–û–®–ò–ë–ö–ê –≤ applyClipEffects: " + e.toString());
					}
				}

				function applyKenBurnsEffect(clip, effects, clipIndex) {
					try {
						$.writeln("=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê KEN BURNS ===");
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º clip
						$.writeln("Clip —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: " + (clip ? "–î–ê" : "–ù–ï–¢"));
						if (!clip) return;
						
						$.writeln("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: " + clip.components.numItems);
						
						// –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
						for (var i = 0; i < clip.components.numItems; i++) {
							var comp = clip.components[i];
							$.writeln("–ö–æ–º–ø–æ–Ω–µ–Ω—Ç[" + i + "]: " + comp.displayName);
						}
						
						// –ü—Ä–æ–≤–µ—Ä—è–µ–º Motion –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
						var motionComponent = clip.components[1];
						if (motionComponent) {
							$.writeln("Motion –Ω–∞–π–¥–µ–Ω: " + motionComponent.displayName);
							$.writeln("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ properties: " + motionComponent.properties.numItems);
							
							// –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ Motion
							for (var p = 0; p < motionComponent.properties.numItems; p++) {
								var prop = motionComponent.properties[p];
								$.writeln("Property[" + p + "]: " + prop.displayName);
								
								// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
								$.writeln("  - isTimeVarying: " + (typeof prop.isTimeVarying === 'function' ? "–ï–°–¢–¨" : "–ù–ï–¢"));
								$.writeln("  - setTimeVarying: " + (typeof prop.setTimeVarying === 'function' ? "–ï–°–¢–¨" : "–ù–ï–¢"));
								$.writeln("  - addKey: " + (typeof prop.addKey === 'function' ? "–ï–°–¢–¨" : "–ù–ï–¢"));
								$.writeln("  - setValueAtKey: " + (typeof prop.setValueAtKey === 'function' ? "–ï–°–¢–¨" : "–ù–ï–¢"));
								$.writeln("  - setValue: " + (typeof prop.setValue === 'function' ? "–ï–°–¢–¨" : "–ù–ï–¢"));
								$.writeln("  - getValue: " + (typeof prop.getValue === 'function' ? "–ï–°–¢–¨" : "–ù–ï–¢"));
							}
						} else {
							$.writeln("Motion –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ù–ï –ù–ê–ô–î–ï–ù –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ 1");
						}
						
					} catch(e) {
						$.writeln("–û–®–ò–ë–ö–ê –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ: " + e.toString());
					}
				}

				function applyEasingToMotion(motionComponent, easingType) {
					try {
						// –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –∫ –∞–Ω–∏–º–∞—Ü–∏–∏
						// –í Premiere Pro —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–∞–¥—Ä–æ–≤
						$.writeln("–ü—Ä–∏–º–µ–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é: " + easingType);
						
						// –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –≤ —Ä–µ–∞–ª—å–Ω–æ–º API –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥
						for (var i = 0; i < motionComponent.properties.numItems; i++) {
							var property = motionComponent.properties[i];
							if (property.isTimeVarying && property.getKeys) {
								var keys = property.getKeys();
								for (var k = 0; k < keys.length; k++) {
									// –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–∏–ø –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
									// –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç API
								}
							}
						}
						
					} catch(e) {
						$.writeln("–û–®–ò–ë–ö–ê –≤ applyEasingToMotion: " + e.toString());
					}
				}

				function applyColorCorrectionQE(clip, effects) {
					try {
						$.writeln("–ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é —á–µ—Ä–µ–∑ QE API");
						
						// –í–∫–ª—é—á–∞–µ–º QE API
						app.enableQE();
						
						// –ü–æ–ª—É—á–∞–µ–º QE –æ–±—ä–µ–∫—Ç –∫–ª–∏–ø–∞
						var sequence = qe.project.getActiveSequence();
						var trackIndex = 0; // –ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç—Ä–µ–∫
						var clipIndex = 0;  // –ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∫–ª–∏–ø–∞
						
						// –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ QE –∫–ª–∏–ø–∞
						// –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º –∑–∞–≥–ª—É—à–∫—É
						$.writeln("–¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ QE API - —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏");
						
					} catch(e) {
						$.writeln("–û–®–ò–ë–ö–ê –≤ applyColorCorrectionQE: " + e.toString());
					}
				}
               
=======
                function applyClipEffects(clip, config, clipIndex) {
                    if (!clip || !clip.isValid()) return;
                    
                    var effects = config.effects;
                    
                    // Ken Burns —ç—Ñ—Ñ–µ–∫—Ç—ã
                    if (effects.kenBurns && effects.kenBurns.length > 0) {
                        applyKenBurns(clip, effects, clipIndex);
                    }
                    
                    // CapCut —ç—Ñ—Ñ–µ–∫—Ç—ã
                    if (effects.capcutEffects && effects.capcutEffects.length > 0) {
                        applyCapcutEffects(clip, effects, clipIndex);
                    }
                    
                    // –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
                    if (effects.colorCorrection) {
                        applyColorCorrection(clip, effects);
                    }
                    
                    // 3D —ç—Ñ—Ñ–µ–∫—Ç—ã
                    if (effects.enable3D) {
                        apply3DEffects(clip, effects);
                    }
                }
                
                function applyKenBurns(clip, effects, clipIndex) {
                    var motionEffect = null;
                    
                    // –ò—â–µ–º Motion —ç—Ñ—Ñ–µ–∫—Ç
                    for (var i = 0; i < clip.components.numItems; i++) {
                        if (clip.components[i].displayName === "Motion") {
                            motionEffect = clip.components[i];
                            break;
                        }
                    }
                    
                    if (!motionEffect) return;
                    
                    // –í—ã–±–∏—Ä–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç
                    var selectedEffect = effects.kbRandomize ? 
                        effects.kenBurns[Math.floor(Math.random() * effects.kenBurns.length)] :
                        effects.kenBurns[clipIndex % effects.kenBurns.length];
                    
                    var intensity = effects.kenBurnsIntensity / 100;
                    var startTime = clip.inPoint.seconds;
                    var endTime = clip.outPoint.seconds;
                    
                    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    var scaleParam = motionEffect.properties.getParamForDisplayName("Scale");
                    var positionParam = motionEffect.properties.getParamForDisplayName("Position");
                    var rotationParam = motionEffect.properties.getParamForDisplayName("Rotation");
                    
                    // –£–º–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
                    var cropCompensation = effects.smartCrop ? 1.1 : 1.0;
                    
                    switch(selectedEffect) {
                        case 'zoomIn':
                            if (scaleParam) {
                                scaleParam.addKey(startTime);
                                scaleParam.setValueAtKey(startTime, 100 * cropCompensation);
                                scaleParam.addKey(endTime);
                                scaleParam.setValueAtKey(endTime, (100 + 30 * intensity) * cropCompensation);
                            }
                            break;
                            
                        case 'zoomOut':
                            if (scaleParam) {
                                scaleParam.addKey(startTime);
                                scaleParam.setValueAtKey(startTime, (100 + 30 * intensity) * cropCompensation);
                                scaleParam.addKey(endTime);
                                scaleParam.setValueAtKey(endTime, 100 * cropCompensation);
                            }
                            break;
                            
                        case 'panLeft':
                        case 'panRight':
                        case 'panUp':
                        case 'panDown':
                            if (positionParam && scaleParam) {
                                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –¥–ª—è —É–º–Ω–æ–π –æ–±—Ä–µ–∑–∫–∏
                                scaleParam.setValue(110 * cropCompensation);
                                
                                var direction = selectedEffect.replace('pan', '').toLowerCase();
                                var moveAmount = 0.1 * intensity;
                                
                                positionParam.addKey(startTime);
                                positionParam.addKey(endTime);
                                
                                var startPos = [0.5, 0.5];
                                var endPos = [0.5, 0.5];
                                
                                if (direction === 'left') endPos[0] -= moveAmount;
                                else if (direction === 'right') endPos[0] += moveAmount;
                                else if (direction === 'up') endPos[1] -= moveAmount;
                                else if (direction === 'down') endPos[1] += moveAmount;
                                
                                positionParam.setValueAtKey(startTime, startPos);
                                positionParam.setValueAtKey(endTime, endPos);
                            }
                            break;
                            
                        case 'rotate':
                            if (rotationParam && scaleParam) {
                                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± –µ—â–µ –±–æ–ª—å—à–µ –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ —É–≥–ª–æ–≤
                                var rotationScale = 1 + (effects.rotationAngle / 90);
                                scaleParam.setValue(100 * cropCompensation * rotationScale);
                                
                                rotationParam.addKey(startTime);
                                rotationParam.setValueAtKey(startTime, -effects.rotationAngle / 2);
                                rotationParam.addKey(endTime);
                                rotationParam.setValueAtKey(endTime, effects.rotationAngle / 2);
                            }
                            break;
                            
                        case 'diagonal':
                            if (positionParam && scaleParam) {
                                scaleParam.setValue(120 * cropCompensation);
                                
                                positionParam.addKey(startTime);
                                positionParam.setValueAtKey(startTime, [0.4, 0.4]);
                                positionParam.addKey(endTime);
                                positionParam.setValueAtKey(endTime, [0.6, 0.6]);
                            }
                            break;
                    }
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é
                    applyEasing(motionEffect, effects.easingType, effects.bezierP1, effects.bezierP2);
                }
                
                function applyCapcutEffects(clip, effects, clipIndex) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –∫ —ç—Ç–æ–º—É –∫–ª–∏–ø—É
                    if (!shouldApplyEffect(clipIndex, effects)) return;
                    
                    var motionEffect = null;
                    for (var i = 0; i < clip.components.numItems; i++) {
                        if (clip.components[i].displayName === "Motion") {
                            motionEffect = clip.components[i];
                            break;
                        }
                    }
                    
                    if (!motionEffect) return;
                    
                    var scaleParam = motionEffect.properties.getParamForDisplayName("Scale");
                    var positionParam = motionEffect.properties.getParamForDisplayName("Position");
                    var rotationParam = motionEffect.properties.getParamForDisplayName("Rotation");
                    
                    var startTime = clip.inPoint.seconds;
                    var endTime = clip.outPoint.seconds;
                    var duration = endTime - startTime;
                    
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
                    var allEffects = effects.capcutEffects.concat(effects.motionEffects || []);
                    var selectedEffect = allEffects[Math.floor(Math.random() * allEffects.length)];
                    
                    switch(selectedEffect) {
                        case 'zoomBurst':
                            if (scaleParam) {
                                var burstDuration = duration * 0.2; // 20% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ burst
                                var startScale = effects.zoomBurstStart || 150;
                                var decay = (effects.zoomBurstDecay || 80) / 100;
                                
                                // –ë—ã—Å—Ç—Ä—ã–π –∑—É–º –≤ –Ω–∞—á–∞–ª–µ
                                scaleParam.addKey(startTime);
                                scaleParam.setValueAtKey(startTime, startScale);
                                
                                // –¢–æ—á–∫–∞ –∑–∞—Ç—É—Ö–∞–Ω–∏—è
                                scaleParam.addKey(startTime + burstDuration);
                                scaleParam.setValueAtKey(startTime + burstDuration, 100 + (startScale - 100) * (1 - decay));
                                
                                // –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–æ –∫–æ–Ω—Ü–∞
                                scaleParam.addKey(endTime);
                                scaleParam.setValueAtKey(endTime, 100);
                                
                                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫—Ä–∏–≤—É—é –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–∫–∞
                                setKeyframeInterpolation(scaleParam, 0, 'ease-out');
                                setKeyframeInterpolation(scaleParam, 1, 'linear');
                            }
                            break;
                            
                        case 'pulse':
                            if (scaleParam) {
                                var amplitude = effects.scaleAmplitude / 100;
                                var pulseCount = Math.floor(duration * 2); // 2 –ø—É–ª—å—Å–∞—Ü–∏–∏ –≤ —Å–µ–∫—É–Ω–¥—É
                                
                                for (var p = 0; p <= pulseCount; p++) {
                                    var time = startTime + (duration * p / pulseCount);
                                    scaleParam.addKey(time);
                                    
                                    // –ß–µ—Ä–µ–¥—É–µ–º –º–∞—Å—à—Ç–∞–±
                                    var scale = p % 2 === 0 ? 100 : 100 + (20 * amplitude);
                                    scaleParam.setValueAtKey(time, scale);
                                }
                            }
                            break;
                            
                        case 'bounce':
                            if (scaleParam) {
                                var bounceHeight = effects.scaleAmplitude / 100;
                                var bounces = 3;
                                
                                scaleParam.addKey(startTime);
                                scaleParam.setValueAtKey(startTime, 100);
                                
                                for (var b = 1; b <= bounces; b++) {
                                    var bounceTime = startTime + (duration * b / (bounces + 1));
                                    var bounceScale = 100 + (30 * bounceHeight * (1 - b/bounces));
                                    
                                    scaleParam.addKey(bounceTime - 0.1);
                                    scaleParam.setValueAtKey(bounceTime - 0.1, bounceScale);
                                    
                                    scaleParam.addKey(bounceTime);
                                    scaleParam.setValueAtKey(bounceTime, 100);
                                }
                            }
                            break;
                            
                        case 'shake':
                            if (positionParam) {
                                var intensity = effects.motionIntensity / 1000;
                                var shakeFrames = 10;
                                
                                for (var s = 0; s < shakeFrames; s++) {
                                    var shakeTime = startTime + (duration * s / shakeFrames);
                                    var offsetX = (Math.random() - 0.5) * intensity;
                                    var offsetY = (Math.random() - 0.5) * intensity;
                                    
                                    positionParam.addKey(shakeTime);
                                    positionParam.setValueAtKey(shakeTime, [0.5 + offsetX, 0.5 + offsetY]);
                                }
                            }
                            break;
                            
                        case 'wobble':
                            if (rotationParam) {
                                var wobbleAngle = effects.motionIntensity / 10;
                                var wobbleCount = Math.floor(duration * 3);
                                
                                for (var w = 0; w <= wobbleCount; w++) {
                                    var wobbleTime = startTime + (duration * w / wobbleCount);
                                    var angle = Math.sin(w * Math.PI) * wobbleAngle;
                                    
                                    rotationParam.addKey(wobbleTime);
                                    rotationParam.setValueAtKey(wobbleTime, angle);
                                }
                            }
                            break;
                            
                        case 'pendulum':
                            if (rotationParam) {
                                var swingAngle = effects.motionIntensity / 5;
                                
                                rotationParam.addKey(startTime);
                                rotationParam.setValueAtKey(startTime, -swingAngle);
                                
                                rotationParam.addKey(startTime + duration/2);
                                rotationParam.setValueAtKey(startTime + duration/2, swingAngle);
                                
                                rotationParam.addKey(endTime);
                                rotationParam.setValueAtKey(endTime, -swingAngle);
                                
                                // –ü—Ä–∏–º–µ–Ω—è–µ–º ease-in-out –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                                setKeyframeInterpolation(rotationParam, 0, 'ease-in-out');
                                setKeyframeInterpolation(rotationParam, 1, 'ease-in-out');
                            }
                            break;
                    }
                }
                
                function shouldApplyEffect(clipIndex, effects) {
                    var frequency = effects.effectFrequency || 'all';
                    
                    if (frequency === 'all') return true;
                    
                    if (frequency === 'percent') {
                        var percent = effects.effectPercent || 50;
                        return Math.random() * 100 < percent;
                    }
                    
                    if (frequency === 'every') {
                        var every = effects.effectEvery || 3;
                        return clipIndex % every === 0;
                    }
                    
                    if (frequency === 'random') {
                        return Math.random() > 0.5;
                    }
                    
                    return false;
                }
                
                function applyColorCorrection(clip, effects) {
                    // –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º Lumetri Color
                    var lumetriEffect = null;
                    
                    for (var i = 0; i < clip.components.numItems; i++) {
                        if (clip.components[i].displayName === "Lumetri Color") {
                            lumetriEffect = clip.components[i];
                            break;
                        }
                    }
                    
                    if (!lumetriEffect) {
                        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç
                        var videoEffects = app.project.rootItem.getVideoEffectByName("Lumetri Color");
                        if (videoEffects) {
                            clip.addVideoEffect(videoEffects);
                            
                            // –ù–∞—Ö–æ–¥–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
                            for (var j = 0; j < clip.components.numItems; j++) {
                                if (clip.components[j].displayName === "Lumetri Color") {
                                    lumetriEffect = clip.components[j];
                                    break;
                                }
                            }
                        }
                    }
                    
                    if (!lumetriEffect || !lumetriEffect.properties) return;
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
                    var filterPresets = {
                        'warm': {temperature: 20, tint: 5, saturation: 110},
                        'cold': {temperature: -20, tint: -5, saturation: 90},
                        'vintage': {temperature: 10, tint: 10, saturation: 80, fadeAmount: 10},
                        'blackwhite': {saturation: 0},
                        'sepia': {temperature: 30, tint: 15, saturation: 50},
                        'cinematic': {temperature: -10, contrast: 110, highlights: -20, shadows: 20, saturation: 95},
                        'vibrant': {vibrance: 130, saturation: 120},
                        'faded': {fadeAmount: 15, contrast: 90, saturation: 85}
                    };
                    
                    var preset = filterPresets[effects.colorFilter];
                    if (preset) {
                        for (var param in preset) {
                            setLumetriParam(lumetriEffect, param, preset[param]);
                        }
                    }
                    
                    // –í–∏–Ω—å–µ—Ç–∫–∞
                    if (effects.vignette) {
                        var vignetteAmount = -(effects.vignetteIntensity / 100) * 2;
                        setLumetriParam(lumetriEffect, "vignetteAmount", vignetteAmount);
                    }
                    
                    // –ó–µ—Ä–Ω–æ
                    if (effects.grain) {
                        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç Noise
                        var noiseEffect = app.project.rootItem.getVideoEffectByName("Noise");
                        if (noiseEffect) {
                            clip.addVideoEffect(noiseEffect);
                            
                            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
                            for (var k = 0; k < clip.components.numItems; k++) {
                                if (clip.components[k].displayName === "Noise") {
                                    var noiseComp = clip.components[k];
                                    var amountParam = noiseComp.properties.getParamForDisplayName("Amount of Noise");
                                    if (amountParam) {
                                        amountParam.setValue(effects.grainIntensity / 100 * 10);
                                    }
                                    break;
                                }
                            }
                        }
                    }
                }
                
                function setLumetriParam(lumetriEffect, paramName, value) {
                    var properties = lumetriEffect.properties;
                    
                    // –ú–∞–ø–ø–∏–Ω–≥ –∏–º–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                    var paramMap = {
                        'temperature': 'Temperature',
                        'tint': 'Tint',
                        'exposure': 'Exposure',
                        'contrast': 'Contrast',
                        'highlights': 'Highlights',
                        'shadows': 'Shadows',
                        'whites': 'Whites',
                        'blacks': 'Blacks',
                        'saturation': 'Saturation',
                        'vibrance': 'Vibrance',
                        'fadeAmount': 'Faded Film Amount',
                        'vignetteAmount': 'Vignette Amount'
                    };
                    
                    var displayName = paramMap[paramName];
                    if (!displayName) return;
                    
                    var param = properties.getParamForDisplayName(displayName);
                    if (param && !param.isTimeVarying()) {
                        param.setValue(value);
                    }
                }
                
                function apply3DEffects(clip, effects) {
                    if (effects.type3D === 'basic') {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Basic 3D —ç—Ñ—Ñ–µ–∫—Ç
                        var basic3D = app.project.rootItem.getVideoEffectByName("Basic 3D");
                        if (basic3D) {
                            clip.addVideoEffect(basic3D);
                            
                            // –ù–∞—Ö–æ–¥–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
                            for (var i = 0; i < clip.components.numItems; i++) {
                                if (clip.components[i].displayName === "Basic 3D") {
                                    var effect3D = clip.components[i];
                                    var intensity = effects.intensity3D / 100;
                                    
                                    // –ê–Ω–∏–º–∏—Ä—É–µ–º –ø–æ–≤–æ—Ä–æ—Ç
                                    var tiltParam = effect3D.properties.getParamForDisplayName("Tilt");
                                    var swivelParam = effect3D.properties.getParamForDisplayName("Swivel");
                                    
                                    if (tiltParam && swivelParam) {
                                        var startTime = clip.inPoint.seconds;
                                        var endTime = clip.outPoint.seconds;
                                        
                                        if (effects.autoRotate3D) {
                                            // –ê–≤—Ç–æ–≤—Ä–∞—â–µ–Ω–∏–µ
                                            swivelParam.addKey(startTime);
                                            swivelParam.setValueAtKey(startTime, -10 * intensity);
                                            swivelParam.addKey(endTime);
                                            swivelParam.setValueAtKey(endTime, 10 * intensity);
                                        } else {
                                            // –°—Ç–∞—Ç–∏—á–Ω—ã–π 3D
                                            tiltParam.setValue(5 * intensity);
                                            swivelParam.setValue(8 * intensity);
                                        }
                                    }
                                    break;
                                }
                            }
                        }
                    }
                }
>>>>>>> 5adb8a335390beae31960bdd51844c4147e887e1
                
                function addTransition(clip1, clip2, effects) {
                    var track = clip1.parentTrack;
                    if (!track) return;
                    
                    var transitions = effects.transitions || ['fade'];
                    var selectedTransition = effects.transRandomize ? 
                        transitions[Math.floor(Math.random() * transitions.length)] :
                        transitions[0];
                    
                    var duration = effects.transitionDuration || 1.0;
                    
                    // –ú–∞–ø–ø–∏–Ω–≥ –∏–º–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
                    var transitionMap = {
                        'fade': 'Dip to Black',
                        'dissolve': 'Cross Dissolve',
                        'dip_black': 'Dip to Black',
                        'dip_white': 'Dip to White',
                        'wipe': 'Linear Wipe',
                        'slide': 'Slide',
                        'push': 'Push',
                        'zoom': 'Cross Zoom'
                    };
                    
                    var transitionName = transitionMap[selectedTransition] || 'Cross Dissolve';
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥
                    var transition = track.getTransitionByName(transitionName);
                    if (transition) {
                        // –ü–æ–∑–∏—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ - –º–µ–∂–¥—É –∫–ª–∏–ø–∞–º–∏
                        var transitionTime = clip1.outPoint.seconds - duration/2;
                        track.insertTransition(transition, transitionTime);
                        
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                        var addedTransition = track.transitions[track.transitions.numItems - 1];
                        if (addedTransition) {
                            addedTransition.duration = duration;
                        }
                    }
                }
                
                function addOverlays(sequence, overlaySettings, totalDuration) {
                    if (!overlaySettings.files || overlaySettings.files.length === 0) return;
                    
                    var videoTrack2 = sequence.videoTracks[1];
                    if (!videoTrack2) return;
                    
                    var currentTime = 0;
                    
                    while (currentTime < totalDuration) {
                        // –í—ã–±–∏—Ä–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
                        var overlayFile = overlaySettings.randomize ?
                            overlaySettings.files[Math.floor(Math.random() * overlaySettings.files.length)] :
                            overlaySettings.files[currentTime % overlaySettings.files.length];
                        
                        // –ù–∞—Ö–æ–¥–∏–º –≤ –ø—Ä–æ–µ–∫—Ç–µ
                        var overlayItem = findProjectItem(overlayFile);
                        if (!overlayItem) continue;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –≤—Ç–æ—Ä–æ–π —Ç—Ä–µ–∫
                        var overlayClip = videoTrack2.insertClip(overlayItem, currentTime);
                        if (!overlayClip) continue;
                        
                        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞–ª–æ–∂–µ–Ω–∏–µ
                        var opacityEffect = null;
                        for (var i = 0; i < overlayClip.components.numItems; i++) {
                            if (overlayClip.components[i].displayName === "Opacity") {
                                opacityEffect = overlayClip.components[i];
                                break;
                            }
                        }
                        
                        if (opacityEffect) {
                            var opacityParam = opacityEffect.properties.getParamForDisplayName("Opacity");
                            if (opacityParam) {
                                opacityParam.setValue(overlaySettings.opacity);
                            }
                        }
                        
                        // –†–µ–∂–∏–º –Ω–∞–ª–æ–∂–µ–Ω–∏—è
                        setBlendMode(overlayClip, overlaySettings.blendMode);
                        
                        // –†–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–µ
                        if (overlaySettings.stretch) {
                            // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å –∫–∞–¥—Ä
                            var motionEffect = null;
                            for (var j = 0; j < overlayClip.components.numItems; j++) {
                                if (overlayClip.components[j].displayName === "Motion") {
                                    motionEffect = overlayClip.components[j];
                                    break;
                                }
                            }
                            
                            if (motionEffect) {
                                var scaleParam = motionEffect.properties.getParamForDisplayName("Scale");
                                if (scaleParam) {
                                    // –ü–æ–¥–≥–æ–Ω—è–µ–º –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞
                                    scaleParam.setValue(120); // –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –¥–ª—è –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è
                                }
                            }
                        }
                        
                        currentTime += overlayClip.duration.seconds;
                    }
                }
                
                function setBlendMode(clip, mode) {
                    // –í Premiere Pro —Ä–µ–∂–∏–º—ã –Ω–∞–ª–æ–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ
                    // –≠—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ API
                    try {
                        var blendModeMap = {
                            'normal': 0,
                            'screen': 3,
                            'overlay': 9,
                            'multiply': 1,
                            'add': 2,
                            'lighten': 5,
                            'darken': 4
                        };
                        
                        var modeValue = blendModeMap[mode] || 0;
                        
                        // –ü–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∂–∏–º –Ω–∞–ª–æ–∂–µ–Ω–∏—è
                        if (clip.setBlendMode) {
                            clip.setBlendMode(modeValue);
                        }
                    } catch(e) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                    }
                }
                
                function applyEasing(effect, easingType, bezierP1, bezierP2) {
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é –∫–æ –≤—Å–µ–º –∫–ª—é—á–µ–≤—ã–º –∫–∞–¥—Ä–∞–º
                    if (!effect || !effect.properties) return;
                    
                    for (var i = 0; i < effect.properties.numItems; i++) {
                        var param = effect.properties[i];
                        if (param.isTimeVarying() && param.getKeys().length > 0) {
                            for (var k = 0; k < param.getKeys().length; k++) {
                                setKeyframeInterpolation(param, k, easingType, bezierP1, bezierP2);
                            }
                        }
                    }
                }
                
                function setKeyframeInterpolation(param, keyIndex, easingType, bezierP1, bezierP2) {
                    try {
                        // –í Premiere Pro –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—É—é –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é
                        var key = param.getKeys()[keyIndex];
                        if (!key) return;
                        
                        switch(easingType) {
                            case 'linear':
                                param.setInterpolationTypeAtKey(key.time, KeyframeInterpolationType.LINEAR);
                                break;
                            case 'ease':
                            case 'ease-in-out':
                                param.setInterpolationTypeAtKey(key.time, KeyframeInterpolationType.BEZIER);
                                param.setTemporalEaseAtKey(key.time, [0.33], [0.33]);
                                break;
                            case 'ease-in':
                                param.setInterpolationTypeAtKey(key.time, KeyframeInterpolationType.BEZIER);
                                param.setTemporalEaseAtKey(key.time, [0.42], [0]);
                                break;
                            case 'ease-out':
                                param.setInterpolationTypeAtKey(key.time, KeyframeInterpolationType.BEZIER);
                                param.setTemporalEaseAtKey(key.time, [0], [0.58]);
                                break;
                            case 'bezier':
                                param.setInterpolationTypeAtKey(key.time, KeyframeInterpolationType.BEZIER);
                                var p1 = (bezierP1 || 25) / 100;
                                var p2 = (bezierP2 || 75) / 100;
                                param.setTemporalEaseAtKey(key.time, [p1], [p2]);
                                break;
                        }
                    } catch(e) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
                    }
                }
            `;
        }

        // === –ù–ê–°–¢–†–û–ô–ö–ò ===

        function loadSettings() {
            const stored = localStorage.getItem('autoMontageSettings');
            if (stored) {
                try {
                    const settings = JSON.parse(stored);
                    
                    document.getElementById('ffmpegPath').value = settings.ffmpegPath || 'ffmpeg.exe';
                    document.getElementById('amePath').value = settings.amePath || '';
                    document.getElementById('pythonPath').value = settings.pythonPath || 'python';
                    document.getElementById('renderThreads').value = settings.renderThreads || 4;
                    document.getElementById('renderThreadsValue').textContent = settings.renderThreads || 4;
                    document.getElementById('useGPU').checked = settings.useGPU !== false;
                    document.getElementById('useProxies').checked = settings.useProxies || false;
                    document.getElementById('preRenderEffects').checked = settings.preRenderEffects || false;
                    document.getElementById('transcodeRussian').checked = settings.transcodeRussian !== false;
                    document.getElementById('keepOriginals').checked = settings.keepOriginals !== false;
                    document.getElementById('cleanupTemp').checked = settings.cleanupTemp || false;
                    document.getElementById('autoSave').checked = settings.autoSave !== false;
                    document.getElementById('autoBackup').checked = settings.autoBackup || false;
                    document.getElementById('showNotifications').checked = settings.showNotifications !== false;
                } catch(e) {
                    log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + e.message, 'warning');
                }
            }
            
            // –ê–≤—Ç–æ–ø–æ–∏—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º
            findMediaEncoder();
        }

        function saveSettings() {
            const settings = {
                ffmpegPath: document.getElementById('ffmpegPath').value,
                amePath: document.getElementById('amePath').value,
                pythonPath: document.getElementById('pythonPath').value,
                renderThreads: parseInt(document.getElementById('renderThreads').value),
                useGPU: document.getElementById('useGPU').checked,
                useProxies: document.getElementById('useProxies').checked,
                preRenderEffects: document.getElementById('preRenderEffects').checked,
                transcodeRussian: document.getElementById('transcodeRussian').checked,
                keepOriginals: document.getElementById('keepOriginals').checked,
                cleanupTemp: document.getElementById('cleanupTemp').checked,
                autoSave: document.getElementById('autoSave').checked,
                autoBackup: document.getElementById('autoBackup').checked,
                showNotifications: document.getElementById('showNotifications').checked
            };
            
            localStorage.setItem('autoMontageSettings', JSON.stringify(settings));
            log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'info');
        }

        function resetSettings() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                localStorage.removeItem('autoMontageSettings');
                loadSettings();
                log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
            }
        }

        function exportSettings() {
            const allSettings = {
                app: JSON.parse(localStorage.getItem('autoMontageSettings') || '{}'),
                channels: channels,
                version: '4.0.0'
            };
            
            const dataStr = JSON.stringify(allSettings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'automontage_complete_settings_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            
            log('–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'info');
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const settings = JSON.parse(event.target.result);
                        
                        if (settings.app) {
                            localStorage.setItem('autoMontageSettings', JSON.stringify(settings.app));
                            loadSettings();
                        }
                        
                        if (settings.channels) {
                            channels = settings.channels;
                            saveChannels();
                            updateChannelLists();
                        }
                        
                        alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'info');
                    } catch (err) {
                        alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + err.message);
                        log('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function browsePath(type) {
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                
                let filter = '';
                let title = '';
                
                switch(type) {
                    case 'ffmpeg':
                        filter = 'ffmpeg.exe';
                        title = '–í—ã–±–µ—Ä–∏—Ç–µ ffmpeg.exe';
                        break;
                    case 'ame':
                        filter = 'Adobe Media Encoder.exe';
                        title = '–í—ã–±–µ—Ä–∏—Ç–µ Adobe Media Encoder.exe';
                        break;
                    case 'python':
                        filter = 'python.exe';
                        title = '–í—ã–±–µ—Ä–∏—Ç–µ python.exe';
                        break;
                }
                
                const extScript = `
                    var file = File.openDialog("${title}", "${filter}");
                    if (file) {
                        file.fsName;
                    } else {
                        null;
                    }
                `;
                
                csInterface.evalScript(extScript, function(result) {
                    if (result && result !== 'null') {
                        document.getElementById(`${type}Path`).value = result;
                        log(`–í—ã–±—Ä–∞–Ω –ø—É—Ç—å ${type}: ${result}`, 'info');
                    }
                });
            } else {
                alert('–í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ Premiere Pro');
            }
        }

        function findMediaEncoder() {
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                
                const extScript = `
                    function findAME() {
                        var paths = [
                            "C:/Program Files/Adobe/Adobe Media Encoder 2024/Adobe Media Encoder.exe",
                            "C:/Program Files/Adobe/Adobe Media Encoder 2023/Adobe Media Encoder.exe",
                            "C:/Program Files/Adobe/Adobe Media Encoder 2022/Adobe Media Encoder.exe",
                            "C:/Program Files/Adobe/Adobe Media Encoder CC 2020/Adobe Media Encoder.exe"
                        ];
                        
                        for (var i = 0; i < paths.length; i++) {
                            var file = new File(paths[i]);
                            if (file.exists) {
                                return paths[i];
                            }
                        }
                        
                        return "";
                    }
                    
                    findAME();
                `;
                
                csInterface.evalScript(extScript, function(result) {
                    if (result && result !== '""') {
                        document.getElementById('amePath').value = result;
                        log('Media Encoder –Ω–∞–π–¥–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏', 'info');
                    }
                });
            }
        }

        function downloadFFmpeg() {
            window.open('https://ffmpeg.org/download.html', '_blank');
            log('–û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏ FFmpeg', 'info');
        }

        function checkPython() {
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                const pythonPath = document.getElementById('pythonPath').value;
                
                const extScript = `
                    function checkPython(path) {
                        try {
                            var result = system.callSystem('"' + path + '" --version');
                            return "Python –Ω–∞–π–¥–µ–Ω: " + result;
                        } catch(e) {
                            return "Python –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
                        }
                    }
                    
                    checkPython("${pythonPath}");
                `;
                
                csInterface.evalScript(extScript, function(result) {
                    alert(result);
                    log(result, result.includes('–Ω–∞–π–¥–µ–Ω') ? 'info' : 'warning');
                });
            } else {
                alert('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Premiere Pro');
            }
        }

        // === –†–ê–ë–û–¢–ê –° –≠–§–§–ï–ö–¢–ê–ú–ò ===

        function loadChannelEffects() {
            const channelId = document.getElementById('channelSelector').value;
            if (!channelId) {
                document.getElementById('effectsEditor').style.display = 'none';
                return;
            }
            
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            currentChannelId = channelId;
            document.getElementById('effectsEditor').style.display = 'block';
            
            const effects = channel.effects;
            const exportSettings = channel.export;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
            document.getElementById('channelResolution').value = exportSettings.resolution || '1920x1080';
            document.getElementById('customResolution').style.display = 
                exportSettings.resolution === 'custom' ? 'block' : 'none';
            document.getElementById('customWidth').value = exportSettings.customWidth || 1920;
            document.getElementById('customHeight').value = exportSettings.customHeight || 1080;
            document.getElementById('channelFps').value = exportSettings.fps || 30;
            document.getElementById('channelBitrate').value = exportSettings.bitrate || 8;
            document.getElementById('channelCodec').value = exportSettings.codec || 'h264';
            
            // Ken Burns
            document.querySelectorAll('.kb-effect').forEach(cb => {
                const effectName = cb.id.replace('kb_', '');
                cb.checked = effects.kenBurns && effects.kenBurns.includes(effectName);
            });
            document.getElementById('kbIntensity').value = effects.kenBurnsIntensity || 30;
            document.getElementById('kbIntensityValue').textContent = (effects.kenBurnsIntensity || 30) + '%';
            document.getElementById('rotationAngle').value = effects.rotationAngle || 5;
            document.getElementById('rotationAngleValue').textContent = (effects.rotationAngle || 5) + '¬∞';
            document.getElementById('kbSmartCrop').checked = effects.smartCrop !== false;
            document.getElementById('kbRandomize').checked = effects.kbRandomize || false;
            
            // –ü–µ—Ä–µ—Ö–æ–¥—ã
            document.querySelectorAll('.transition-effect').forEach(cb => {
                const effectName = cb.id.replace('trans_', '');
                cb.checked = effects.transitions && effects.transitions.includes(effectName);
            });
            document.getElementById('transitionDuration').value = effects.transitionDuration || 1.0;
            document.getElementById('transRandomize').checked = effects.transRandomize || false;
            
            // –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
            document.getElementById('enableColorCorrection').checked = effects.colorCorrection || false;
            document.getElementById('colorCorrectionSettings').style.display = effects.colorCorrection ? 'block' : 'none';
            document.getElementById('colorFilter').value = effects.colorFilter || 'none';
            document.getElementById('enableVignette').checked = effects.vignette || false;
            document.getElementById('vignetteSettings').style.display = effects.vignette ? 'block' : 'none';
            document.getElementById('vignetteIntensity').value = effects.vignetteIntensity || 40;
            document.getElementById('vignetteIntensityValue').textContent = (effects.vignetteIntensity || 40) + '%';
            document.getElementById('enableGrain').checked = effects.grain || false;
            document.getElementById('grainSettings').style.display = effects.grain ? 'block' : 'none';
            document.getElementById('grainIntensity').value = effects.grainIntensity || 20;
            document.getElementById('grainIntensityValue').textContent = (effects.grainIntensity || 20) + '%';
            
            // –ê—É–¥–∏–æ
            document.getElementById('audioPitch').value = effects.audioPitch || '0';
            document.getElementById('audioEffect').value = effects.audioEffect || 'none';
            document.getElementById('audioStereoEnhance').checked = effects.audioStereoEnhance || false;
            document.getElementById('audioNormalize').checked = effects.audioNormalize !== false;
            
            // –ü–ª–∞–≤–Ω–æ—Å—Ç—å
            document.getElementById('easingType').value = effects.easingType || 'ease';
            document.getElementById('bezierSettings').style.display = effects.easingType === 'bezier' ? 'block' : 'none';
            document.getElementById('bezierP1').value = effects.bezierP1 || 25;
            document.getElementById('bezierP1Value').textContent = effects.bezierP1 || 25;
            document.getElementById('bezierP2').value = effects.bezierP2 || 75;
            document.getElementById('bezierP2Value').textContent = effects.bezierP2 || 75;
            
            // 3D
            document.getElementById('enable3D').checked = effects.enable3D || false;
            document.getElementById('3dSettings').style.display = effects.enable3D ? 'block' : 'none';
            document.getElementById('3dType').value = effects.type3D || 'basic';
            document.getElementById('3dIntensity').value = effects.intensity3D || 20;
            document.getElementById('3dIntensityValue').textContent = (effects.intensity3D || 20) + '%';
            document.getElementById('3dAutoRotate').checked = effects.autoRotate3D || false;
        }

        function saveChannelEffects() {
            if (!currentChannelId) return;
            
            const channel = channels.find(c => c.id === currentChannelId);
            if (!channel) return;
            
            // –°–æ–±–∏—Ä–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
            const exportSettings = {
                resolution: document.getElementById('channelResolution').value,
                customWidth: parseInt(document.getElementById('customWidth').value),
                customHeight: parseInt(document.getElementById('customHeight').value),
                fps: parseInt(document.getElementById('channelFps').value),
                bitrate: parseInt(document.getElementById('channelBitrate').value),
                codec: document.getElementById('channelCodec').value
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            const effects = {
                // Ken Burns
                kenBurns: [],
                kenBurnsIntensity: parseInt(document.getElementById('kbIntensity').value),
                rotationAngle: parseInt(document.getElementById('rotationAngle').value),
                smartCrop: document.getElementById('kbSmartCrop').checked,
                kbRandomize: document.getElementById('kbRandomize').checked,
                
                // –ü–µ—Ä–µ—Ö–æ–¥—ã
                transitions: [],
                transitionDuration: parseFloat(document.getElementById('transitionDuration').value),
                transRandomize: document.getElementById('transRandomize').checked,
                
                // –¶–≤–µ—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
                colorCorrection: document.getElementById('enableColorCorrection').checked,
                colorFilter: document.getElementById('colorFilter').value,
                vignette: document.getElementById('enableVignette').checked,
                vignetteIntensity: parseInt(document.getElementById('vignetteIntensity').value),
                grain: document.getElementById('enableGrain').checked,
                grainIntensity: parseInt(document.getElementById('grainIntensity').value),
                
                // –ê—É–¥–∏–æ
                audioPitch: document.getElementById('audioPitch').value,
                audioEffect: document.getElementById('audioEffect').value,
                audioStereoEnhance: document.getElementById('audioStereoEnhance').checked,
                audioNormalize: document.getElementById('audioNormalize').checked,
                
                // –ü–ª–∞–≤–Ω–æ—Å—Ç—å
                easingType: document.getElementById('easingType').value,
                bezierP1: parseInt(document.getElementById('bezierP1').value),
                bezierP2: parseInt(document.getElementById('bezierP2').value),
                
                // 3D
                enable3D: document.getElementById('enable3D').checked,
                type3D: document.getElementById('3dType').value,
                intensity3D: parseInt(document.getElementById('3dIntensity').value),
                autoRotate3D: document.getElementById('3dAutoRotate').checked
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            document.querySelectorAll('.kb-effect:checked').forEach(cb => {
                effects.kenBurns.push(cb.id.replace('kb_', ''));
            });
            
            document.querySelectorAll('.transition-effect:checked').forEach(cb => {
                effects.transitions.push(cb.id.replace('trans_', ''));
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CapCut —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            if (channel.effects.capcutEffects) {
                effects.capcutEffects = channel.effects.capcutEffects;
                effects.scaleAmplitude = channel.effects.scaleAmplitude;
                effects.zoomBurstStart = channel.effects.zoomBurstStart;
                effects.zoomBurstDecay = channel.effects.zoomBurstDecay;
                effects.motionEffects = channel.effects.motionEffects;
                effects.motionIntensity = channel.effects.motionIntensity;
                effects.effectFrequency = channel.effects.effectFrequency;
                effects.effectPercent = channel.effects.effectPercent;
                effects.effectEvery = channel.effects.effectEvery;
                effects.avoidRepetition = channel.effects.avoidRepetition;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            channel.export = exportSettings;
            channel.effects = effects;
            saveChannels();
            log(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã`, 'info');
        }

        function resetChannelEffects() {
            if (!currentChannelId) return;
            
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                loadChannelEffects();
                log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
            }
        }

        function previewEffects() {
            alert('–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
        }

        function duplicateToChannel() {
            if (!currentChannelId) return;
            
            const sourceChannel = channels.find(c => c.id === currentChannelId);
            if (!sourceChannel) return;
            
            const channelNames = channels
                .filter(c => c.id !== currentChannelId)
                .map(c => c.name)
                .join('\n');
            
            const targetName = prompt(`–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–∞–Ω–∞–ª:\n\n${channelNames}\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞:`);
            if (!targetName) return;
            
            const targetChannel = channels.find(c => c.name === targetName && c.id !== currentChannelId);
            if (!targetChannel) {
                alert('–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            targetChannel.effects = JSON.parse(JSON.stringify(sourceChannel.effects));
            targetChannel.export = JSON.parse(JSON.stringify(sourceChannel.export));
            saveChannels();
            log(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –∫–∞–Ω–∞–ª "${targetName}"`, 'info');
        }

        // === –†–ê–ë–û–¢–ê –° –û–í–ï–†–õ–ï–Ø–ú–ò ===

        function selectOverlaysFolder() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            if (window.cep && window.cep.fs) {
                // CEP –æ–∫—Ä—É–∂–µ–Ω–∏–µ
                const result = window.cep.fs.showOpenDialogEx(false, true, "–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –æ–≤–µ—Ä–ª–µ—è–º–∏", "");
                if (result.data && result.data.length > 0) {
                    OVERLAYS_FOLDER = result.data[0];
                    document.getElementById('overlaysPath').value = OVERLAYS_FOLDER;
                    scanOverlaysFolder();
                }
            } else {
                // –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º - —Å–∏–º—É–ª—è—Ü–∏—è
                const simulatedPath = prompt("–í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –æ–≤–µ—Ä–ª–µ—è–º–∏:", "C:/Overlays");
                if (simulatedPath) {
                    OVERLAYS_FOLDER = simulatedPath;
                    document.getElementById('overlaysPath').value = simulatedPath;
                    
                    // –°–∏–º—É–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –æ–≤–µ—Ä–ª–µ–µ–≤
                    overlayFiles = [
                        {name: 'particles.mp4', type: 'video'},
                        {name: 'film_grain.mov', type: 'video'},
                        {name: 'light_leak.mp4', type: 'video'},
                        {name: 'frame_vintage.png', type: 'image'},
                        {name: 'dust.mp4', type: 'video'}
                    ];
                    
                    log(`–ù–∞–π–¥–µ–Ω–æ –æ–≤–µ—Ä–ª–µ–µ–≤: ${overlayFiles.length}`, 'info');
                }
            }
        }

        function scanOverlaysFolder() {
            if (!OVERLAYS_FOLDER) return;
            
            const extScript = `
                function scanOverlays(folderPath) {
                    try {
                        var folder = new Folder(folderPath);
                        if (!folder.exists) return {files: [], error: "–ü–∞–ø–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"};
                        
                        var overlays = [];
                        var files = folder.getFiles();
                        var supportedFormats = ['.mp4', '.mov', '.avi', '.png', '.gif'];
                        
                        for (var i = 0; i < files.length; i++) {
                            if (files[i] instanceof File) {
                                var fileName = files[i].name;
                                var ext = fileName.substr(fileName.lastIndexOf('.')).toLowerCase();
                                
                                if (supportedFormats.indexOf(ext) > -1) {
                                    var type = (ext === '.png' || ext === '.gif') ? 'image' : 'video';
                                    overlays.push({
                                        name: fileName,
                                        path: files[i].fsName,
                                        type: type
                                    });
                                }
                            }
                        }
                        
                        return {files: overlays};
                        
                    } catch(e) {
                        return {files: [], error: e.toString()};
                    }
                }
                
                JSON.stringify(scanOverlays("${OVERLAYS_FOLDER.replace(/\\/g, '\\\\')}"));
            `;
            
            if (typeof CSInterface !== 'undefined') {
                const csInterface = new CSInterface();
                csInterface.evalScript(extScript, function(result) {
                    try {
                        const scanResult = JSON.parse(result);
                        overlayFiles = scanResult.files;
                        log(`–ù–∞–π–¥–µ–Ω–æ –æ–≤–µ—Ä–ª–µ–µ–≤: ${overlayFiles.length}`, 'info');
                    } catch(e) {
                        log('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–≤–µ—Ä–ª–µ–µ–≤: ' + e.message, 'error');
                    }
                });
            }
        }

        function loadChannelOverlays() {
            const channelId = document.getElementById('overlayChannelSelector').value;
            if (!channelId) {
                document.getElementById('overlaySettings').style.display = 'none';
                return;
            }
            
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            document.getElementById('overlaySettings').style.display = 'block';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–≤–µ—Ä–ª–µ–µ–≤
            const overlaysList = document.getElementById('overlaysList');
            overlaysList.innerHTML = '';
            
            if (!overlayFiles || overlayFiles.length === 0) {
                overlaysList.innerHTML = '<div class="info-text">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –æ–≤–µ—Ä–ª–µ—è–º–∏</div>';
                return;
            }
            
            overlayFiles.forEach((overlay, index) => {
                const item = document.createElement('div');
                item.className = 'effect-item';
                item.innerHTML = `
                    <input type="checkbox" id="overlay_${index}" class="overlay-file" data-name="${overlay.name}">
                    <label for="overlay_${index}">
                        ${overlay.type === 'video' ? 'üé¨' : 'üñºÔ∏è'} ${overlay.name}
                    </label>
                `;
                overlaysList.appendChild(item);
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            if (channel.overlays) {
                document.getElementById('overlayBlendMode').value = channel.overlays.blendMode || 'screen';
                document.getElementById('overlayOpacity').value = channel.overlays.opacity || 100;
                document.getElementById('overlayOpacityValue').textContent = (channel.overlays.opacity || 100) + '%';
                document.getElementById('overlayRandomize').checked = channel.overlays.randomize || false;
                document.getElementById('overlayStretch').checked = channel.overlays.stretch !== false;
                
                // –û—Ç–º–µ—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
                if (channel.overlays.files) {
                    channel.overlays.files.forEach(fileName => {
                        const checkbox = document.querySelector(`.overlay-file[data-name="${fileName}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            }
        }

        function saveOverlaySettings() {
            const channelId = document.getElementById('overlayChannelSelector').value;
            if (!channelId) return;
            
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            const selectedFiles = [];
            document.querySelectorAll('.overlay-file:checked').forEach(cb => {
                selectedFiles.push(cb.dataset.name);
            });
            
            channel.overlays = {
                enabled: selectedFiles.length > 0,
                files: selectedFiles,
                blendMode: document.getElementById('overlayBlendMode').value,
                opacity: parseInt(document.getElementById('overlayOpacity').value),
                randomize: document.getElementById('overlayRandomize').checked,
                stretch: document.getElementById('overlayStretch').checked
            };
            
            saveChannels();
            updateChannelLists();
            log(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–≤–µ—Ä–ª–µ–µ–≤ –¥–ª—è –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã`, 'info');
        }

        // === CAPCUT –≠–§–§–ï–ö–¢–´ ===

        function loadChannelCapcutEffects() {
            const channelId = document.getElementById('capcutChannelSelector').value;
            if (!channelId) {
                document.getElementById('capcutEffectsEditor').style.display = 'none';
                return;
            }
            
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            document.getElementById('capcutEffectsEditor').style.display = 'block';
            
            const effects = channel.effects;
            
            // –ê–Ω–∏–º–∞—Ü–∏–∏ –º–∞—Å—à—Ç–∞–±–∞
            document.querySelectorAll('.capcut-effect').forEach(cb => {
                const effectName = cb.id.replace('fx_', '');
                cb.checked = effects.capcutEffects && effects.capcutEffects.includes(effectName);
            });
            
            document.getElementById('scaleAmplitude').value = effects.scaleAmplitude || 15;
            document.getElementById('scaleAmplitudeValue').textContent = (effects.scaleAmplitude || 15) + '%';
            document.getElementById('zoomBurstStart').value = effects.zoomBurstStart || 150;
            document.getElementById('zoomBurstStartValue').textContent = (effects.zoomBurstStart || 150) + '%';
            document.getElementById('zoomBurstDecay').value = effects.zoomBurstDecay || 80;
            document.getElementById('zoomBurstDecayValue').textContent = (effects.zoomBurstDecay || 80) + '%';
            
            document.getElementById('motionIntensity').value = effects.motionIntensity || 30;
            document.getElementById('motionIntensityValue').textContent = (effects.motionIntensity || 30) + '%';
            
            // –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
            document.getElementById('effectFrequency').value = effects.effectFrequency || 'all';
            document.getElementById('effectPercent').value = effects.effectPercent || 50;
            document.getElementById('effectPercentValue').textContent = (effects.effectPercent || 50) + '%';
            document.getElementById('effectEvery').value = effects.effectEvery || 3;
            document.getElementById('avoidRepetition').checked = effects.avoidRepetition !== false;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Å—Ç–æ—Ç—ã
            const freq = effects.effectFrequency || 'all';
            document.getElementById('percentSettings').style.display = freq === 'percent' ? 'block' : 'none';
            document.getElementById('everySettings').style.display = freq === 'every' ? 'block' : 'none';
        }

        function saveCapcutEffects() {
            const channelId = document.getElementById('capcutChannelSelector').value;
            if (!channelId) return;
            
            const channel = channels.find(c => c.id === channelId);
            if (!channel) return;
            
            const capcutEffects = [];
            const motionEffects = [];
            
            document.querySelectorAll('.capcut-effect:checked').forEach(cb => {
                const effectName = cb.id.replace('fx_', '');
                if (['zoomBurst', 'pulse', 'bounce', 'elastic', 'wave'].includes(effectName)) {
                    capcutEffects.push(effectName);
                } else {
                    motionEffects.push(effectName);
                }
            });
            
            channel.effects.capcutEffects = capcutEffects;
            channel.effects.motionEffects = motionEffects;
            channel.effects.scaleAmplitude = parseInt(document.getElementById('scaleAmplitude').value);
            channel.effects.zoomBurstStart = parseInt(document.getElementById('zoomBurstStart').value);
            channel.effects.zoomBurstDecay = parseInt(document.getElementById('zoomBurstDecay').value);
            channel.effects.motionIntensity = parseInt(document.getElementById('motionIntensity').value);
            channel.effects.effectFrequency = document.getElementById('effectFrequency').value;
            channel.effects.effectPercent = parseInt(document.getElementById('effectPercent').value);
            channel.effects.effectEvery = parseInt(document.getElementById('effectEvery').value);
            channel.effects.avoidRepetition = document.getElementById('avoidRepetition').checked;
            
            saveChannels();
            updateChannelLists();
            log(`CapCut —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∫–∞–Ω–∞–ª–∞ "${channel.name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã`, 'info');
        }

        function presetCapcutEffects(presetType) {
            const presets = {
                dynamic: {
                    capcutEffects: ['zoomBurst', 'bounce'],
                    motionEffects: ['shake', 'wobble'],
                    scaleAmplitude: 25,
                    motionIntensity: 40,
                    effectFrequency: 'percent',
                    effectPercent: 60
                },
                smooth: {
                    capcutEffects: ['pulse', 'wave'],
                    motionEffects: ['pendulum'],
                    scaleAmplitude: 10,
                    motionIntensity: 20,
                    effectFrequency: 'every',
                    effectEvery: 3
                },
                epic: {
                    capcutEffects: ['zoomBurst', 'elastic'],
                    motionEffects: ['shake', 'glitch'],
                    scaleAmplitude: 30,
                    zoomBurstStart: 180,
                    zoomBurstDecay: 90,
                    motionIntensity: 50,
                    effectFrequency: 'all'
                }
            };
            
            const preset = presets[presetType];
            if (!preset) return;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–µ—Å–µ—Ç
            document.querySelectorAll('.capcut-effect').forEach(cb => {
                const effectName = cb.id.replace('fx_', '');
                cb.checked = preset.capcutEffects.includes(effectName) || preset.motionEffects.includes(effectName);
            });
            
            if (preset.scaleAmplitude !== undefined) {
                document.getElementById('scaleAmplitude').value = preset.scaleAmplitude;
                document.getElementById('scaleAmplitudeValue').textContent = preset.scaleAmplitude + '%';
            }
            
            if (preset.zoomBurstStart !== undefined) {
                document.getElementById('zoomBurstStart').value = preset.zoomBurstStart;
                document.getElementById('zoomBurstStartValue').textContent = preset.zoomBurstStart + '%';
            }
            
            if (preset.zoomBurstDecay !== undefined) {
                document.getElementById('zoomBurstDecay').value = preset.zoomBurstDecay;
                document.getElementById('zoomBurstDecayValue').textContent = preset.zoomBurstDecay + '%';
            }
            
            if (preset.motionIntensity !== undefined) {
                document.getElementById('motionIntensity').value = preset.motionIntensity;
                document.getElementById('motionIntensityValue').textContent = preset.motionIntensity + '%';
            }
            
            document.getElementById('effectFrequency').value = preset.effectFrequency || 'all';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–∞—Å—Ç–æ—Ç—ã
            document.getElementById('percentSettings').style.display = preset.effectFrequency === 'percent' ? 'block' : 'none';
            document.getElementById('everySettings').style.display = preset.effectFrequency === 'every' ? 'block' : 'none';
            
            if (preset.effectPercent !== undefined) {
                document.getElementById('effectPercent').value = preset.effectPercent;
                document.getElementById('effectPercentValue').textContent = preset.effectPercent + '%';
            }
            
            if (preset.effectEvery !== undefined) {
                document.getElementById('effectEvery').value = preset.effectEvery;
            }
            
            log(`–ü—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–µ—Å–µ—Ç CapCut —ç—Ñ—Ñ–µ–∫—Ç–æ–≤: ${presetType}`, 'info');
        }
    </script>
</body>

</html>


